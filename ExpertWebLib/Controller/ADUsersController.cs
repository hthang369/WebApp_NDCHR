using System;
using System.Data;

namespace ExpertWebLib
{
    #region ADUsers
    //-----------------------------------------------------------
    //Generated By: SQLDBTools.Net ♫ Hồռ؏ ₤ĩռᶋ (v2.0.91)
    //Class: ADUsersController
    //Created Date: Thursday, 05 Jul 2018
    //-----------------------------------------------------------
    
    public class ADUsersController : BaseBusinessController
    {
        private readonly string spGetADUsersByADUserGroupID = "ADUsers_SelectByADUserGroupID";
        public ADUsersController()
        {
            dal = new DALBaseProvider("ADUsers",typeof(ADUsersInfo));
        }
        public int CreateUser(ADUsersInfo objADUsersInfo)
        {
            objADUsersInfo.ADPassword = new Crypto().Encrypt(objADUsersInfo.ADPassword);
            objADUsersInfo.ADUserID = base.dal.GetMaxID() + 1;
            return base.dal.CreateObject(objADUsersInfo);
        }

        public DataSet GetAllUserByUserGroupID(int iADUserGroupID)
        {
            object[] paramValues = new object[] { iADUserGroupID };
            return base.dal.GetDataSet(this.spGetADUsersByADUserGroupID, paramValues);
        }

        public int GetUserGroupOfUser(int iADUserID)
        {
            return ((ADUsersInfo)this.GetObjectByID(iADUserID)).ADUserGroupID;
        }

        public int GetUserGroupOfUser(string strUserName)
        {
            ADUsersInfo objectByName = new ADUsersInfo();
            objectByName = (ADUsersInfo)this.GetObjectByName(strUserName);
            if (objectByName != null)
            {
                return objectByName.ADUserGroupID;
            }
            return 0;
        }

        public int UpdateUser(ADUsersInfo objADUsersInfo, bool bChange)
        {
            if (bChange)
            {
                objADUsersInfo.ADPassword = new Crypto().Encrypt(objADUsersInfo.ADPassword);
            }
            return base.dal.UpdateObject(objADUsersInfo);
        }
        public ADUsersInfo GetDataByEmployeeID(int iEmployeeID)
        {
            DataTable dt = GetDataTable(string.Format(@"SELECT a.* 
                                                        FROM ADUsers a 
                                                        JOIN HREmployees b ON a.ADUserID = b.FK_ADUserID 
                                                            AND a.AAStatus = 'Alive'
                                                            AND b.AAStatus = 'Alive'
                                                            AND b.HREmployeeID = {0}", iEmployeeID));
            if (dt != null && dt.Rows.Count > 0)
                return GetObjectFromDataRow(dt.Rows[0]) as ADUsersInfo;
            return null;
        }
    }
    #endregion
}