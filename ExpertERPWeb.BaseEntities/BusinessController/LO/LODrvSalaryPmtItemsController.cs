using System;
using System.Data;
using System.Text;
using System.Collections.Generic;
using ExpertWebLib;
namespace ExpertERP.BusinessEntities
{
	#region LODrvSalaryPmtItems
	//-----------------------------------------------------------
	//Generated By: Expert Studio
	//Class:LODrvSalaryPmtItemsController
	//Created Date:10 Tháng Giêng 2013
	//-----------------------------------------------------------
	
	public class LODrvSalaryPmtItemsController:BaseBusinessController
	{
		public LODrvSalaryPmtItemsController()
		{
			dal= new DALBaseProvider("LODrvSalaryPmtItems",typeof(LODrvSalaryPmtItemsInfo));
        }

        #region Copy From PS --Vinh --10/01/2013

        public LODrvSalaryPmtItemsInfo GetObjectByEmployeeID(int iDrvSalaryPmtID, int iFK_HREmployee)
        {
            string strQuery = String.Format(@"SELECT TOP 1 * FROM LODrvSalaryPmtItems WHERE AAStatus='Alive' AND FK_HREmployeeID={0} AND FK_LODrvSalaryPmtID={1}", iFK_HREmployee, iDrvSalaryPmtID);
            DataSet ds = this.GetDataSet(strQuery);
            if (ds != null && ds.Tables.Count > 0 && ds.Tables[0].Rows.Count > 0)
            {
                return (LODrvSalaryPmtItemsInfo)this.GetObjectFromDataRow(ds.Tables[0].Rows[0]);
            }
            else
                return null;

        }

        public bool Check_CalculatedSalary(int CarID, int Period, int Year)
        {
            string strQuery = String.Format(@"SELECT * FROM LODrvSalaryPmtItems WHERE AAStatus='Alive' AND FK_LOCarID={0} AND MONTH(LODrvSalaryPmtItemFromDate) ={1} AND YEAR(LODrvSalaryPmtItemFromDate)={2}", CarID, Period, Year);
            DataSet ds = this.GetDataSet(strQuery);
            if (ds != null && ds.Tables.Count > 0 && ds.Tables[0].Rows.Count > 0)
                return true;

            return false;

        }

        public LODrvSalaryPmtItemsInfo GetSalaryInPeriod(int iEmployeeID, int Period, int Year)
        {
            string strQuery = String.Format(@"SELECT * FROM LODrvSalaryPmtItems WHERE AAStatus='Alive' AND FK_HREmployeeID={0} AND MONTH(LODrvSalaryPmtItemFromDate) ={1} AND YEAR(LODrvSalaryPmtItemFromDate)={2}
                                                AND FK_LODrvSalaryPmtID IN (SELECT LODrvSalaryPmtID FROM LODrvSalaryPmts WHERE 
                                                                                AAStatus = 'Alive'
                                                                                AND LODrvSalaryPmtReadyToCalculateSalary = 'true')", iEmployeeID, Period, Year);
            DataSet ds = this.GetDataSet(strQuery);
            if (ds != null && ds.Tables.Count > 0 && ds.Tables[0].Rows.Count > 0)
                return (LODrvSalaryPmtItemsInfo)GetObjectFromDataRow(ds.Tables[0].Rows[0]);

            return null;

        }

        #endregion
    }
	#endregion
}