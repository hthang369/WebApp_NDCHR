using System;
using System.Data;
using System.Text;
using System.Collections.Generic;
using ExpertWebLib;
namespace ExpertERP.BusinessEntities
{
    #region HRBonusAllowanceItems
    //-----------------------------------------------------------
    //Generated By: GMC Studio
    //Class:HRBonusAllowanceItemsController
    //Created Date:15 Tháng Ba 2013
    //-----------------------------------------------------------

    public class HRBonusAllowanceItemsController : BaseBusinessController
    {
        public HRBonusAllowanceItemsController()
        {
            dal = new DALBaseProvider("HRBonusAllowanceItems", typeof(HRBonusAllowanceItemsInfo));
        }

        #region Lấy số tiền của nhân viên được thưởng thêm --Vinh --16/03/2013

        public double GetAmtBonusByEmployeeANDStatusANDDate(int iEmployeeID, String strPayrollTypeNo, DateTime dtFrom, DateTime dtTo)
        {
            String str = String.Format(@"   SELECT SUM(BAItem.HRBonusAllowanceItemAmt) 
                                            FROM dbo.HRBonusAllowances BA
                                                INNER JOIN dbo.HRBonusAllowanceItems BAItem ON BA.HRBonusAllowanceID = BAItem.FK_HRBonusAllowanceID
                                            WHERE BA.AAStatus='Alive' AND BAItem.AAStatus='Alive'
                                            AND BA.FK_HRPayrollTypeID IN (SELECT HRPayrollTypeID FROM dbo.HRPayrollTypes WHERE AAStatus = 'Alive' AND HRPayrollTypeNo LIKE '{0}')
                                            AND BAItem.FK_HREmployeeID={1}
                                            AND (HRBonusAllowanceMonth + HRBonusAllowanceYear*12) >= {2}
                                            AND (HRBonusAllowanceMonth + HRBonusAllowanceYear*12) <= {3}
                                            
                                            ", strPayrollTypeNo, iEmployeeID, dtFrom.Month + dtFrom.Year * 12, dtTo.Month + dtTo.Year * 12);
            DataSet ds = dal.GetDataSet(str);
            if (ds != null && ds.Tables.Count > 0 && ds.Tables[0].Rows.Count > 0 && ds.Tables[0].Rows[0][0] != DBNull.Value)
            {
                return double.Parse(ds.Tables[0].Rows[0][0].ToString());
            }
            return 0;
        }

        #endregion

        #region Lấy tất cả biến động tiền lương của nhân viên --Vinh --2013.12.04

        public DataSet GetAllBonusByEmployeeANDStatusANDDate(int iEmployeeID, String strPayrollTypeNo, DateTime dtMonth)
        {
            String str = String.Format(@"   SELECT BAItem.*
                                            FROM dbo.HRBonusAllowances BA
                                                INNER JOIN dbo.HRBonusAllowanceItems BAItem ON BA.HRBonusAllowanceID = BAItem.FK_HRBonusAllowanceID
                                            WHERE BA.AAStatus='Alive' AND BAItem.AAStatus='Alive'
                                            AND BA.FK_HRPayrollTypeID IN (SELECT HRPayrollTypeID FROM dbo.HRPayrollTypes WHERE AAStatus = 'Alive' AND HRPayrollTypeNo LIKE '{0}')
                                            AND BAItem.FK_HREmployeeID={1}
                                            AND HRBonusAllowanceMonth = {2}
                                            AND HRBonusAllowanceYear = {3}
                                            ", strPayrollTypeNo, iEmployeeID, dtMonth.Month, dtMonth.Year);
            return dal.GetDataSet(str);
        }
        public DataSet GetAllBonusByEmployeeANDStatusANDDate(int iEmployeeID, int iPayrollTypeID, DateTime dtMonth)
        {
            String str = String.Format(@"SELECT HRBonusAllowanceTypeCombo,BAItem.HRBonusAllowanceItemAmt as HRBonusAllowanceItemAmt
                                            FROM dbo.HRBonusAllowances BA
                                                INNER JOIN dbo.HRBonusAllowanceItems BAItem ON BA.HRBonusAllowanceID = BAItem.FK_HRBonusAllowanceID
                                            WHERE BA.AAStatus='Alive' AND BAItem.AAStatus='Alive'
                                            AND BA.FK_HRPayrollTypeID ={0}
                                            AND BAItem.FK_HREmployeeID={1}
                                            AND HRBonusAllowanceMonth = {2}
                                            AND HRBonusAllowanceYear = {3}", iPayrollTypeID, iEmployeeID, dtMonth.Month, dtMonth.Year);
            return dal.GetDataSet(str);
        }
        public DataSet GetAllBonusByEmployeeANDStatusANDDateANDType(int iEmployeeID, int iPayrollTypeID, DateTime dtMonth, string strAllowanceType)
        {
            String str = String.Format(@"   SELECT BAItem.*
                                            FROM dbo.HRBonusAllowances BA
                                                INNER JOIN dbo.HRBonusAllowanceItems BAItem ON BA.HRBonusAllowanceID = BAItem.FK_HRBonusAllowanceID
                                            WHERE BA.AAStatus='Alive' AND BAItem.AAStatus='Alive'
                                            AND BA.FK_HRPayrollTypeID ={0}
                                            AND BAItem.FK_HREmployeeID={1}
                                            AND HRBonusAllowanceMonth = {2}
                                            AND HRBonusAllowanceYear = {3}
                                            AND HRBonusAllowanceTypeCombo='{4}'
                                            ", iPayrollTypeID, iEmployeeID, dtMonth.Month, dtMonth.Year, strAllowanceType);
            return dal.GetDataSet(str);
        }
        public DataSet GetAllBonusByDate(DateTime dtDate)
        {
            String str = String.Format(@"SELECT BAItem.*
                                            FROM dbo.HRBonusAllowances BA
                                                INNER JOIN dbo.HRBonusAllowanceItems BAItem ON BA.HRBonusAllowanceID = BAItem.FK_HRBonusAllowanceID
                                            WHERE BA.AAStatus='Alive' AND BAItem.AAStatus='Alive'                                  
                                            AND HRBonusAllowanceMonth = {0}
                                            AND HRBonusAllowanceYear = {1}
                                            ",dtDate.Month, dtDate.Year);
            return dal.GetDataSet(str);
        }
        public DataSet GetAllBonusByEmployeeIDAndDate(int iEmployeeID,DateTime dtDate)
        {
            String str = String.Format(@"SELECT BAItem.*
                                            FROM dbo.HRBonusAllowances BA
                                                INNER JOIN dbo.HRBonusAllowanceItems BAItem ON BA.HRBonusAllowanceID = BAItem.FK_HRBonusAllowanceID
                                            WHERE BA.AAStatus='Alive' AND BAItem.AAStatus='Alive'  
                                            AND BAItem.FK_HREmployeeID={0}                                
                                            AND HRBonusAllowanceMonth = {1}
                                            AND HRBonusAllowanceYear = {2}
                                            ", iEmployeeID,dtDate.Month, dtDate.Year);
            return dal.GetDataSet(str);
        }
        #endregion
    }
    #endregion
}