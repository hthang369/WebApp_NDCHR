using System;
using System.Data;
using System.Text;
using System.Collections.Generic;
using ExpertWebLib;
namespace ExpertERP.BusinessEntities
{
	#region HRPmtInsuranceItems
	//-----------------------------------------------------------
	//Generated By: Expert Studio
	//Class:HRPmtInsuranceItemsController
	//Created Date:26 Tháng Chín 2013
	//-----------------------------------------------------------
	
	public class HRPmtInsuranceItemsController:BaseBusinessController
	{
		public HRPmtInsuranceItemsController()
		{
			dal= new DALBaseProvider("HRPmtInsuranceItems",typeof(HRPmtInsuranceItemsInfo));
		}

        public DataSet GetEmployeeInsuranceByPeriodAndYear(int iperiod, int iYear)
        {
            String str = String.Format(@"SELECT FK_HREmployeeID
                                    FROM dbo.HREmployeeInsurances 				                        
                                    WHERE AAStatus = 'Alive'
                                        AND (MONTH(HREmployeeInsuranceDateFrom)+ YEAR(HREmployeeInsuranceDateFrom)*12)<= ({0}+{1} * 12)
                                        --AND (MONTH(HREmployeeInsuranceDateTo)+ YEAR(HREmployeeInsuranceDateTo)*12)>= ({0}+{1} * 12)
                                        AND HREmployeeInsuranceStatusCombo = 'InDeclaration'", iperiod, iYear);
            return dal.GetDataSet(str);
        }

        public DataSet GetEmployeeInPmtInsucranceByFirstPeriodAndYear(int iperiod, int iYear)
        {
            String str = String.Format(@"SELECT dbo.HRPmtInsuranceItems.FK_HREmployeeID
									FROM dbo.HRPmtInsuranceItems 
									WHERE FK_HRPmtInsuranceID IN ( SELECT dbo.HRPmtInsurances.HRPmtInsuranceID 
																	FROM dbo.HRPmtInsurances 
																	WHERE AAStatus ='Alive' AND MONTH(HRPmtInsurances.HRPmtInsuranceDate)+ YEAR(HRPmtInsurances.HRPmtInsuranceDate)*12= ({0}+{1} * 12 -1)
									)", iperiod, iYear);
            return dal.GetDataSet(str);
        }

        public HRPmtInsuranceItemsInfo GetPmtInsucranceItemByEmpIDAndPeriodAndYear( int iEmployeeID,int iperiod, int iYear)
        {
            String str = String.Format(@"SELECT *
                                        FROM dbo.HRPmtInsuranceItems 
                                        JOIN dbo.HRPmtInsurances ON (HRPmtInsurances.HRPmtInsuranceID = HRPmtInsuranceItems.FK_HRPmtInsuranceID)
                                        WHERE HRPmtInsuranceItems.FK_HREmployeeID={0} AND HRPmtInsurances.AAStatus ='Alive' 
                                        AND MONTH(HRPmtInsurances.HRPmtInsuranceDate)={1} AND YEAR(HRPmtInsurances.HRPmtInsuranceDate)={2}", iEmployeeID, iperiod, iYear);
            DataSet ds = dal.GetDataSet(str);
            if (ds != null)
            {
                if (ds.Tables.Count > 0)
                {
                    foreach (DataRow row in ds.Tables[0].Rows)
                    {
                        HRPmtInsuranceItemsInfo objHRPmtInsuranceItemInfo = (HRPmtInsuranceItemsInfo)dal.GetObjectFromDataRow(row);
                        return objHRPmtInsuranceItemInfo;
                    }

                }
            }
            return null;
        }



        public DataSet GetEmployeeInHRInsAdjTypeReduce(int iperiod, int iYear)
        {
            String str = String.Format(@"SELECT dbo.HRInsAdjs.FK_HREmployeeID
									FROM dbo.HRInsAdjs 
									WHERE HRInsAdjs.HRInsAdjTypeCombo='Reduce'
											AND AAStatus ='Alive'
											AND FK_HRInsuranceStageID IN ( SELECT dbo.HRInsuranceStages.HRInsuranceStageID
																	FROM dbo.HRInsuranceStages 
																	WHERE AAStatus ='Alive' 
																	AND HRInsuranceStages.HRInsurancePeriodCombo+ HRInsuranceStages.HRInsuranceYearCombo *12= ({0}+{1} * 12)
																	
									)", iperiod, iYear);
            return dal.GetDataSet(str);
        }

        public DataSet GetEmployeeInHRInsAdjTypeINC(int iperiod, int iYear)
        {
            String str = String.Format(@"SELECT dbo.HRInsAdjs.FK_HREmployeeID
									FROM dbo.HRInsAdjs 
									WHERE HRInsAdjs.HRInsAdjTypeCombo='INC'
											AND AAStatus ='Alive'
											AND FK_HRInsuranceStageID IN ( SELECT dbo.HRInsuranceStages.HRInsuranceStageID
																	FROM dbo.HRInsuranceStages 
																	WHERE AAStatus ='Alive' 
																	AND HRInsuranceStages.HRInsurancePeriodCombo+ HRInsuranceStages.HRInsuranceYearCombo *12= ({0}+{1} * 12)
																	
									)", iperiod, iYear);
            return dal.GetDataSet(str);
        }
	}
	#endregion
}