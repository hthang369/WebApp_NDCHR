using System;
using System.Data;
using System.Text;
using System.Collections.Generic;
using ExpertWebLib;
namespace ExpertERP.BusinessEntities
{
    #region HREmployeeTCSrls
    //-----------------------------------------------------------
    //Generated By: Expert Studio
    //Class:HREmployeeTCSrlsController
    //Created Date:09 Tháng Giêng 2013
    //-----------------------------------------------------------

    public class HREmployeeTCSrlsController : BaseBusinessController
    {
        public HREmployeeTCSrlsController()
        {
            dal = new DALBaseProvider("HREmployeeTCSrls", typeof(HREmployeeTCSrlsInfo));
        }

        #region Copy From PS --Vinh --10/01/2013

        public DataSet dsGetAll_WithTime(DateTime dtFrom, DateTime dtTo)
        {
            return dal.GetDataSet("AAA_dsEmployeeTCSrls_FromDateToDate", dtFrom, dtTo);
        }
        public void AAADelete_WithTime(DateTime dtFrom, DateTime dtTo)
        {
            DataSet ds = dal.GetDataSet("AAA_HREmployeeTCSrls_DeleteWithTime", dtFrom, dtTo);
        }

        public HREmployeeTCSrlsInfo GetObjectByEmployeeIDAndExtractTimeSpan(int iEmployeeID, DateTime dStartDate, DateTime dEndDate)
        {
            DataSet ds = dal.GetDataSet("HREmployeeTCSrls_SelectByFK_HREmployeeIDAndExtractTimeSpan", iEmployeeID, dStartDate.Date, dEndDate.Date);
            if (ds == null || ds.Tables.Count <= 0 || ds.Tables[0].Rows.Count <= 0)
                return null;
            else
                return (HREmployeeTCSrlsInfo)this.GetObjectFromDataRow(ds.Tables[0].Rows[0]);

        }
        public HREmployeeTCSrlsInfo GetObjectByEmployeeIDAndFdateTdate(int iEmployeeID, DateTime dStartDate, DateTime dEndDate)
        {
            string strsql = string.Format(@"SELECT * 
                                         FROM dbo.HREmployeeTCSrls WHERE AAStatus='Alive'
                                         AND FK_HREmployeeID={0} 
                                        AND CONVERT(NVARCHAR(10), HREmployeeTCSrlFromDatetime,112)='{1}' 
                                        AND CONVERT(NVARCHAR(10), HREmployeeTCSrlToDatetime,112)='{2}'", iEmployeeID, dStartDate.ToString("yyyyMMdd"), dEndDate.ToString("yyyyMMdd"));
            DataSet ds = dal.GetDataSet(strsql);
            if (ds == null || ds.Tables.Count <= 0 || ds.Tables[0].Rows.Count <= 0)
                return null;
            else
                return (HREmployeeTCSrlsInfo)this.GetObjectFromDataRow(ds.Tables[0].Rows[0]);

        }

        #endregion

        #region CheckEmployeeTCSrl --Vinh --22/03/2013 --Kiểm tra có chấm công trong tháng hay chưa

        public Boolean checkEmployeeTCSrlExistMonth(DateTime dt, int iEmployeeID)
        {
            String str = String.Format(@"   SELECT * FROM dbo.HREmployeeTCSrls
                                            WHERE AAStatus='Alive'
                                            AND YEAR(HREmployeeTCSrlFromDatetime) * 12 + MONTH(HREmployeeTCSrlFromDatetime) = {0}
                                            AND FK_HREmployeeID = {1}", dt.Year * 12 + dt.Month, iEmployeeID);

            DataSet ds = dal.GetDataSet(str);
            if (ds != null && ds.Tables.Count > 0 && ds.Tables[0].Rows.Count > 0)
            {
                return true;
            }
            return false;
        }

        #endregion

        #region DeleteALLEmployeeTCSrl --Vinh --22/03/2013 --Xóa bảng công trong tháng

        public void DeleteEmployeeTCSrlExistMonth(DateTime dt, int iEmployeeID)
        {
            String str = String.Format(@"   DELETE dbo.HREmployeeTCSrls
                                            WHERE AAStatus='Alive'
                                            AND YEAR(HREmployeeTCSrlFromDatetime) * 12 + MONTH(HREmployeeTCSrlFromDatetime) = {0}
                                            AND FK_HREmployeeID = {1}", dt.Year * 12 + dt.Month, iEmployeeID);
            DataSet ds = dal.GetDataSet(str);
        }

        #endregion

        #region GetALLEmployeeTCSrl --Vinh --22/03/2013 -- lấy bảng công trong tháng

        public DataSet GetAllEmployeeTCSrlExistMonth(DateTime dt, int iEmployeeID, int iDepartmentID, int iSectionID)
        {
            String str = String.Format(@"   SELECT * FROM dbo.HREmployeeTCSrls
                                            WHERE AAStatus='Alive'
                                            AND YEAR(HREmployeeTCSrlFromDatetime) * 12 + MONTH(HREmployeeTCSrlFromDatetime) = {0}
                                            AND FK_HREmployeeID IN (SELECT HREmployeeID FROM dbo.HREmployees 
                                                                    WHERE AAStatus='Alive' 
                                                                    AND (HREmployeeID = {1} OR {1} = 0) 
                                                                    AND (FK_HRDepartmentID = {2} OR {2} = 0)
                                                                    AND (FK_HRSectionID = {3} OR {3} = 0)
                                                                    ) 
                                        ", dt.Year * 12 + dt.Month, iEmployeeID, iDepartmentID, iSectionID);
            return dal.GetDataSet(str);
        }

        #endregion

        #region Lấy Tính công của nhân viên --Vinh --11/10/2013 

        public HREmployeeTCSrlsInfo GetHREmployeeTCSrlInMonthByEmployee(int iEmployeeID, DateTime dt)
        {
            String str = String.Format(@"   SELECT * FROM dbo.HREmployeeTCSrls
                                            WHERE AAStatus='Alive'
                                            AND YEAR(HREmployeeTCSrlFromDatetime) * 12 + MONTH(HREmployeeTCSrlFromDatetime) = {0}
                                            AND FK_HREmployeeID IN (
                                                                        SELECT HREmployeeID FROM dbo.HREmployees 
                                                                        WHERE AAStatus='Alive' 
                                                                        AND HREmployeeID = {1}
                                                                    ) 
                                        ", dt.Year * 12 + dt.Month, iEmployeeID);
            DataSet ds = dal.GetDataSet(str);
            if (ds != null && ds.Tables.Count > 0 && ds.Tables[0].Rows.Count > 0)
            {
                return (HREmployeeTCSrlsInfo)dal.GetObjectFromDataRow(ds.Tables[0].Rows[0]);
            }
            return null;
        }

        #endregion
    }
    #endregion
}