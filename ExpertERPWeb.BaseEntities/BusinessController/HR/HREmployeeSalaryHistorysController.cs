using System;
using System.Data;
using System.Text;
using System.Collections.Generic;
using ExpertWebLib;
namespace ExpertERP.BusinessEntities
{
	#region HREmployeeSalaryHistorys
	//-----------------------------------------------------------
	//Generated By: Expert Studio
	//Class:HREmployeeSalaryHistorysController
	//Created Date:10 Tháng Giêng 2013
	//-----------------------------------------------------------
	
	public class HREmployeeSalaryHistorysController:BaseBusinessController
	{
		public HREmployeeSalaryHistorysController()
		{
			dal= new DALBaseProvider("HREmployeeSalaryHistorys",typeof(HREmployeeSalaryHistorysInfo));
        }

        #region Copy From PS --Vinh --10/01/2013

        public DataSet GetHREmployeeSalaryHistoryByEmployeeID(int iHREmployeeID, int iHREmployeeSalaryHistoryID)
        {
            String strQuery = String.Format("SELECT * FROM [dbo].[HREmployeeSalaryHistorys] {0}", QueryCondition(iHREmployeeID, iHREmployeeSalaryHistoryID));
            return dal.GetDataSet(strQuery);
        }
        private String QueryCondition(int iHREmployeeID, int iHREmployeeSalaryHistoryID)
        {
            return String.Format("Where [FK_HREmployeeID]={0} AND [AAStatus]='{1}' AND [HREmployeeSalaryHistoryID]<>{2} AND [AACreatedDate]=[AAUpdatedDate]", iHREmployeeID, BusinessObject.DefaultAAStatus, iHREmployeeSalaryHistoryID);
        }

        #endregion

        #region Lấy tất cả lịch sử thay đổi lương của nhân viên --Vinh --24/10/2013

        public DataSet GetAllDataByEmployee(int iHREmployeeID)
        {
            String str = String.Format(@"   SELECT * FROM dbo.HREmployeeSalaryHistorys
                                            WHERE AAStatus = 'Alive'
                                            AND (FK_HREmployeeID = {0} OR {0} = 0)", iHREmployeeID);
            return dal.GetDataSet(str);
        }

        public int MaxCountHistory(List<HREmployeesInfo> lstHREmployees)
        {
            String strListEmployee = String.Empty;
            for (int i = 0; i < lstHREmployees.Count; i++)
            {
                if (i == 0)
                {
                    strListEmployee = "(" + lstHREmployees[i].HREmployeeID;
                }
                else
                {
                    strListEmployee += ", " + lstHREmployees[i].HREmployeeID;
                }

                if (i == lstHREmployees.Count - 1)
                {
                    strListEmployee += ") ";
                }
            }

            String str = String.Format(@"   SELECT MAX(CountHistory) AS MaxCountHistory 
                                            FROM (
                                                SELECT COUNT(*) AS CountHistory FROM dbo.HREmployeeSalaryHistorys
                                                WHERE AAStatus = 'Alive'
                                                AND FK_HREmployeeID IN {0}
                                                GROUP BY FK_HREmployeeID
                                            ) AS TB  ", strListEmployee);
            DataSet ds = dal.GetDataSet(str);
            if (ds != null && ds.Tables.Count > 0 && ds.Tables[0].Rows.Count > 0 && ds.Tables[0].Rows[0][0] != DBNull.Value)
            {
                return Convert.ToInt32(ds.Tables[0].Rows[0][0]);
            }
            return 0;
        }
        #endregion
    }
	#endregion
}