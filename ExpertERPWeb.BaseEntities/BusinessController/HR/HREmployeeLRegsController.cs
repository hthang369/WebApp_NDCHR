using System;
using System.Data;
using System.Text;
using System.Collections.Generic;
using ExpertWebLib;
namespace ExpertERP.BusinessEntities
{
	#region HREmployeeLRegs
	//-----------------------------------------------------------
	//Generated By: Expert Studio
	//Class:HREmployeeLRegsController
	//Created Date:09 Tháng Giêng 2013
	//-----------------------------------------------------------
	
	public class HREmployeeLRegsController:BaseBusinessController
	{
		public HREmployeeLRegsController()
		{
			dal= new DALBaseProvider("HREmployeeLRegs",typeof(HREmployeeLRegsInfo));
        }



        public DataSet GetEmployeeLRegByYear(int iYear)
        {
            String strQuery = String.Format("SELECT * FROM [dbo].[HREmployeeLRegs] WHERE [HREmployeeLRegYear]={0} AND [AAStatus]='{1}' AND [FK_HREmployeeID] IN (SELECT HREmployeeID FROM [dbo].[HREmployees] WHERE [AAStatus]='{1}')", iYear, BusinessObject.DefaultAAStatus);
            return dal.GetDataSet(strQuery);
        }

        public HREmployeeLRegsInfo GetEmployeeLRegByEmployeeIDAndYear(int iEmployeeID, int iYear)
        {
            String strQuery = String.Format("SELECT * FROM [dbo].[HREmployeeLRegs]WHERE [HREmployeeLRegYear]={0} AND [AAStatus]='{1}' AND [FK_HREmployeeID] =(SELECT HREmployeeID FROM [dbo].[HREmployees] WHERE [AAStatus]='{1}'AND [HREmployeeID]={2} )", iYear, BusinessObject.DefaultAAStatus, iEmployeeID);
            DataSet ds = dal.GetDataSet(strQuery);
            if (ds != null)
            {
                if (ds.Tables.Count > 0)
                {
                    foreach (DataRow row in ds.Tables[0].Rows)
                    {
                        HREmployeeLRegsInfo objHREmployeeLRegsInfo = (HREmployeeLRegsInfo)dal.GetObjectFromDataRow(row);
                        return objHREmployeeLRegsInfo;
                    }

                }
            }
            return null;
        }
        public int GetNumberYear(DateTime dt1,DateTime dt2)
        {
            string str = string.Format("SELECT ABS(DATEDIFF(month, '{0}', '{1}'))  AS DiffDate", dt1.ToString("MM-dd-yyyy"),dt2.ToString("MM-dd-yyyy"));
            DataSet ds = dal.GetDataSet(str);
            if (ds != null)
            {
                if (ds.Tables.Count > 0 && ds.Tables[0].Rows.Count>0)
                {
                    try
                    {
                        return (int.Parse(ds.Tables[0].Rows[0][0].ToString()) / 12);
                    }
                    catch
                    {
                        return 0;
                    }
                }
            }
            return 0;
        }

        public int CountExpDaysByEmployeeIDAndYear(int iEmployeeID,int iMonth,int iyear)
        {
            string str = string.Format(@"SELECT COUNT(*) FROM dbo.HREmployeeLRegs WHERE AAStatus='Alive' AND HREmployeeLRegExpDays>0 and FK_HREmployeeID={0} AND HREmployeeLRegYear={1} and HREmployeeLRegMonth<>{2}", iEmployeeID,iyear,iMonth);
            DataSet ds = dal.GetDataSet(str);
            if (ds != null)
            {
                if (ds.Tables.Count > 0 && ds.Tables[0].Rows.Count > 0)
                {
                    try
                    {
                        return int.Parse(ds.Tables[0].Rows[0][0].ToString());
                    }
                    catch
                    {
                        return 0;
                    }
                }
            }
            return 0;
        }

        public double TinhSoNgayNghiTuThangDenThangTrongNam( int iEmployeeID, int iFromMonth,int iToMonth, int iyear)
        {
            string str = string.Format(@"SELECT sum(HREmployeeLRegLeaveDays) FROM dbo.HREmployeeLRegs WHERE AAStatus='Alive' AND FK_HREmployeeID={0} AND (HREmployeeLRegMonth>={1} AND HREmployeeLRegMonth<={2}) AND HREmployeeLRegYear={3}",iEmployeeID,iFromMonth,iToMonth,iyear);
            DataSet ds = dal.GetDataSet(str);
            if (ds != null)
            {
                if (ds.Tables.Count > 0 && ds.Tables[0].Rows.Count > 0)
                {
                    try
                    {
                        return double.Parse(ds.Tables[0].Rows[0][0].ToString());
                    }
                    catch
                    {
                        return 0;
                    }
                }
            }
            return 0;
        }

        public DataSet GetEmployeeLRegByMonthAndYear(int iMonth,int iYear)
        {
            String strQuery = String.Format("SELECT * FROM dbo.HREmployeeLRegs WHERE AAStatus='Alive' AND HREmployeeLRegMonth={0} AND HREmployeeLRegYear={1}", iMonth, iYear);
            return dal.GetDataSet(strQuery);
        }

        public HREmployeeLRegsInfo GetEmployeeLRegByEmployeeIDAndMonthAndYear(int iEmployeeID, int iMonth, int iYear)
        {
            String strQuery = String.Format("SELECT * FROM dbo.HREmployeeLRegs WHERE AAStatus='Alive' AND FK_HREmployeeID={0} AND HREmployeeLRegMonth={1} AND HREmployeeLRegYear={2}", iEmployeeID,iMonth, iYear);
            DataSet ds = dal.GetDataSet(strQuery);
            if (ds != null)
            {
                if (ds.Tables.Count > 0)
                {
                    foreach (DataRow row in ds.Tables[0].Rows)
                    {
                        HREmployeeLRegsInfo objHREmployeeLRegsInfo = (HREmployeeLRegsInfo)dal.GetObjectFromDataRow(row);
                        return objHREmployeeLRegsInfo;
                    }

                }
            }
            return null;
        }
        public DataSet GetmaxMonthAndYearCal()
        {
            String strQuery = String.Format(@"	SELECT TOP 1 * FROM	 dbo.HREmployeeLRegs
						WHERE HREmployeeLRegMonth= ( SELECT MAX(HREmployeeLRegMonth) FROM dbo.HREmployeeLRegs
										  WHERE HREmployeeLRegYear=(SELECT MAX(HREmployeeLRegYear) FROM dbo.HREmployeeLRegs WHERE AAStatus='Alive') AND AAStatus='Alive')		
						AND HREmployeeLRegYear=	(SELECT MAX(HREmployeeLRegYear) FROM dbo.HREmployeeLRegs WHERE AAStatus='Alive') AND AAStatus='Alive'");
            return dal.GetDataSet(strQuery);
        }
        public DataSet GetmaxYearCal()
        {
            String strQuery = String.Format(@"SELECT TOP 1 * FROM dbo.HREmployeeLRegs
						                        WHERE HREmployeeLRegYear=(SELECT MAX(HREmployeeLRegYear) FROM dbo.HREmployeeLRegs WHERE AAStatus='Alive') AND AAStatus='Alive'");
            return dal.GetDataSet(strQuery);
        }

        public double GetEmployeeBymaxMonthAndYearCal(int iEmployeeID)
        {
            String strQuery = String.Format(@"SELECT HREmployeeLRegs.HREmployeeLRegTotDays FROM	 dbo.HREmployeeLRegs
						WHERE HREmployeeLRegMonth= ( SELECT MAX(HREmployeeLRegMonth) FROM dbo.HREmployeeLRegs
										  WHERE HREmployeeLRegYear=(SELECT MAX(HREmployeeLRegYear) FROM dbo.HREmployeeLRegs WHERE AAStatus='Alive' AND FK_HREmployeeID={0}) AND AAStatus='Alive' AND FK_HREmployeeID={0} )		
						AND HREmployeeLRegYear=	(SELECT MAX(HREmployeeLRegYear) FROM dbo.HREmployeeLRegs WHERE AAStatus='Alive' AND FK_HREmployeeID={0}) AND AAStatus='Alive' AND FK_HREmployeeID={0}", iEmployeeID);
            DataSet ds = dal.GetDataSet(strQuery);
            if (ds != null)
            {
                if (ds.Tables.Count > 0)
                {
                    foreach (DataRow row in ds.Tables[0].Rows)
                    {
                        HREmployeeLRegsInfo objHREmployeeLRegsInfo = (HREmployeeLRegsInfo)dal.GetObjectFromDataRow(row);
                        return objHREmployeeLRegsInfo.HREmployeeLRegTotDays;
                    }

                }
            }
            return 0;
        }
        public double GetREmployeeLRegTotDayCurrent(int iEmployeeID,int imonth, int iyear)
        {
            String strQuery = String.Format(@"SELECT HREmployeeLRegs.HREmployeeLRegTotDays FROM	 dbo.HREmployeeLRegs
						WHERE  AAStatus='Alive' AND FK_HREmployeeID={0} AND HREmployeeLRegMonth={1} AND HREmployeeLRegYear={2}", iEmployeeID, imonth,iyear);
            DataSet ds = dal.GetDataSet(strQuery);
            if (ds != null)
            {
                if (ds.Tables.Count > 0)
                {
                    foreach (DataRow row in ds.Tables[0].Rows)
                    {
                        HREmployeeLRegsInfo objHREmployeeLRegsInfo = (HREmployeeLRegsInfo)dal.GetObjectFromDataRow(row);
                        return objHREmployeeLRegsInfo.HREmployeeLRegTotDays;
                    }

                }
            }
            return 0;
        }
        public DataSet DeleteAllEmployeeLRegByYear(int iYear)
        {
            String strQuery = String.Format(@"UPDATE dbo.HREmployeeLRegs SET AAStatus='Delete' WHERE HREmployeeLRegYear={0}", iYear);
            return dal.GetDataSet(strQuery);
        }
    }
	#endregion
}