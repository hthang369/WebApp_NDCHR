using System;
using System.Data;
using System.Text;
using System.Collections.Generic;
using ExpertWebLib;
namespace ExpertERP.BusinessEntities
{
	#region HREmployeeAnnualRegs
	//-----------------------------------------------------------
	//Generated By: GMC Studio
	//Class:HREmployeeAnnualRegsController
	//Created Date:Wednesday, January 31, 2018
	//-----------------------------------------------------------
	
	public class HREmployeeAnnualRegsController:BaseBusinessController
	{
		public HREmployeeAnnualRegsController()
		{
			dal= new DALBaseProvider("HREmployeeAnnualRegs",typeof(HREmployeeAnnualRegsInfo));
		}
        public DataSet GetAllDataQueryByYear(int iYear)
        {
            string str = string.Format(@"
                                        SELECT temp.*,ISNULL(temp.[Kỳ 1],0) + ISNULL(temp.[Kỳ 2],0)+ISNULL(temp.[Kỳ 3],0)+ ISNULL(temp.[Kỳ 4],0)+
                                        ISNULL(temp.[Kỳ 5],0)+ISNULL(temp.[Kỳ 6],0)+ISNULL(temp.[Kỳ 7],0)+ISNULL(temp.[Kỳ 8],0)+
                                        ISNULL(temp.[Kỳ 9],0)+ISNULL(temp.[Kỳ 10],0)+ISNULL(temp.[Kỳ 11],0)+ISNULL(temp.[Kỳ 12],0)AS'Tổng ngày phép'
                                        FROM 
                                            (SELECT HREmployeeNo AS 'Mã nhân viên',
                                            HREmployeeFullName AS 'Tên nhân viên',
                                            HREmployeeStartWorkingDate AS 'Ngày vào làm',
                                            HREmployeeWorkingDate AS 'Ngày vào làm chính thức ',
                                            HREmployeeEndWorkingDate AS 'Ngày kết thúc làm việc',
                                            HRContractTypeName AS 'Loại hợp đồng đang áp dụng',
                                            HRDepartmentName AS 'Phòng ban',
                                            HRSectionName AS 'Bộ phận',
                                            HRPositionName AS 'Chức vụ',
                                            HRAreaName AS 'Khu vực',
                                            BRBranchName AS 'Chi nhánh',
                                            (SELECT SUM(ISNULL(HREmployeeAnnualRegDay, 0)) FROM dbo.HREmployeeAnnualRegs WHERE AAStatus = 'Alive' AND FK_HREmployeeID = HREmployeeID AND HREmployeeAnnualRegMonth = 1 AND HREmployeeAnnualRegYear ={0}) AS 'Kỳ 1',
                                            (SELECT SUM(ISNULL(HREmployeeAnnualRegDay, 0)) FROM dbo.HREmployeeAnnualRegs WHERE AAStatus = 'Alive' AND FK_HREmployeeID = HREmployeeID AND HREmployeeAnnualRegMonth = 2 AND HREmployeeAnnualRegYear = {0}) AS 'Kỳ 2',
                                            (SELECT SUM(ISNULL(HREmployeeAnnualRegDay, 0)) FROM dbo.HREmployeeAnnualRegs WHERE AAStatus = 'Alive' AND FK_HREmployeeID = HREmployeeID AND HREmployeeAnnualRegMonth = 3 AND HREmployeeAnnualRegYear = {0}) AS 'Kỳ 3',
                                            (SELECT SUM(ISNULL(HREmployeeAnnualRegDay, 0)) FROM dbo.HREmployeeAnnualRegs WHERE AAStatus = 'Alive' AND FK_HREmployeeID = HREmployeeID AND HREmployeeAnnualRegMonth = 4 AND HREmployeeAnnualRegYear = {0}) AS 'Kỳ 4',
                                            (SELECT SUM(ISNULL(HREmployeeAnnualRegDay, 0)) FROM dbo.HREmployeeAnnualRegs WHERE AAStatus = 'Alive' AND FK_HREmployeeID = HREmployeeID AND HREmployeeAnnualRegMonth = 5 AND HREmployeeAnnualRegYear = {0}) AS 'Kỳ 5',
                                            (SELECT SUM(ISNULL(HREmployeeAnnualRegDay, 0)) FROM dbo.HREmployeeAnnualRegs WHERE AAStatus = 'Alive' AND FK_HREmployeeID = HREmployeeID AND HREmployeeAnnualRegMonth = 6 AND HREmployeeAnnualRegYear = {0}) AS 'Kỳ 6',
                                            (SELECT SUM(ISNULL(HREmployeeAnnualRegDay, 0)) FROM dbo.HREmployeeAnnualRegs WHERE AAStatus = 'Alive' AND FK_HREmployeeID = HREmployeeID AND HREmployeeAnnualRegMonth = 7 AND HREmployeeAnnualRegYear = {0}) AS 'Kỳ 7',
                                            (SELECT SUM(ISNULL(HREmployeeAnnualRegDay, 0)) FROM dbo.HREmployeeAnnualRegs WHERE AAStatus = 'Alive' AND FK_HREmployeeID = HREmployeeID AND HREmployeeAnnualRegMonth = 8 AND HREmployeeAnnualRegYear = {0}) AS 'Kỳ 8',
                                            (SELECT SUM(ISNULL(HREmployeeAnnualRegDay, 0)) FROM dbo.HREmployeeAnnualRegs WHERE AAStatus = 'Alive' AND FK_HREmployeeID = HREmployeeID AND HREmployeeAnnualRegMonth = 9 AND HREmployeeAnnualRegYear = {0}) AS 'Kỳ 9',
                                            (SELECT SUM(ISNULL(HREmployeeAnnualRegDay, 0)) FROM dbo.HREmployeeAnnualRegs WHERE AAStatus = 'Alive' AND FK_HREmployeeID = HREmployeeID AND HREmployeeAnnualRegMonth = 10 AND HREmployeeAnnualRegYear = {0}) AS 'Kỳ 10',
                                            (SELECT SUM(ISNULL(HREmployeeAnnualRegDay, 0)) FROM dbo.HREmployeeAnnualRegs WHERE AAStatus = 'Alive' AND FK_HREmployeeID = HREmployeeID AND HREmployeeAnnualRegMonth = 11 AND HREmployeeAnnualRegYear = {0}) AS 'Kỳ 11',
                                            (SELECT SUM(ISNULL(HREmployeeAnnualRegDay, 0)) FROM dbo.HREmployeeAnnualRegs WHERE AAStatus = 'Alive' AND FK_HREmployeeID = HREmployeeID AND HREmployeeAnnualRegMonth = 12 AND HREmployeeAnnualRegYear = {0}) AS 'Kỳ 12'
                                            FROM dbo.HREmployees
                                            LEFT JOIN dbo.HRDepartments ON (HRDepartments.HRDepartmentID = HREmployees.FK_HRDepartmentID AND HRDepartments.AAStatus = HREmployees.AAStatus)
                                            LEFT JOIN dbo.HRSections ON (HRSections.HRSectionID = HREmployees.FK_HRSectionID AND HRSections.AAStatus = HREmployees.AAStatus)
                                            LEFT JOIN dbo.HRPositions ON (HRPositions.HRPositionID = HREmployees.FK_HRPositionID AND HRPositions.AAStatus = HREmployees.AAStatus)
                                            LEFT JOIN dbo.HRAreas ON (HRAreas.HRAreaID = HREmployees.FK_HRAreaID AND HRAreas.AAStatus = HREmployees.AAStatus)
                                            LEFT JOIN dbo.BRBranchs ON (BRBranchs.BRBranchID = HREmployees.FK_BRBranchID AND BRBranchs.AAStatus = HREmployees.AAStatus)
                                            LEFT JOIN dbo.HRContractTypes ON (HRContractTypes.HRContractTypeID = HREmployees.FK_HRContractTypeID AND HRContractTypes.AAStatus = HREmployees.AAStatus)
                                            WHERE HREmployees.AAStatus = 'Alive'
                                       ) temp", iYear);
            return dal.GetDataSet(str);
        }
        public int TotalDaynnualRegByEmployeeIDAndYear(int iEmployeeID, int iYear)
        {
            string sql = string.Format(@"SELECT SUM(ISNULL(HREmployeeAnnualRegDay,0))
                                        FROM dbo.HREmployeeAnnualRegs
                                        WHERE AAStatus = 'Alive'
                                        AND FK_HREmployeeID ={0}
                                        AND HREmployeeAnnualRegYear = {1}",iEmployeeID,iYear);
            DataSet ds = dal.GetDataSet(sql);
            if(ds!=null && ds.Tables.Count>0 && ds.Tables[0].Rows.Count>0)
            {
                if (ds.Tables[0].Rows[0][0] != DBNull.Value)
                    return Convert.ToInt32(ds.Tables[0].Rows[0][0]);
                return 0;
            }
            return 0;
        }
        public int TotalDaynnualRegByEmployeeIDAndToMonthAndYear(int iEmployeeID,int iMonth,int iYear)
        {
            string sql = string.Format(@"SELECT SUM(ISNULL(HREmployeeAnnualRegDay,0))
                                            FROM dbo.HREmployeeAnnualRegs
                                            WHERE AAStatus='Alive' 
                                            AND FK_HREmployeeID={0}
                                            AND (HREmployeeAnnualRegMonth>=1 AND HREmployeeAnnualRegMonth<={1})
                                            AND HREmployeeAnnualRegYear={2}
                                            ", iEmployeeID, iMonth, iYear);
            DataSet ds = dal.GetDataSet(sql);
            if (ds != null && ds.Tables.Count > 0 && ds.Tables[0].Rows.Count > 0)
            {
                if (ds.Tables[0].Rows[0][0] != DBNull.Value)
                    return Convert.ToInt32(ds.Tables[0].Rows[0][0]);
                return 0;
            }
            return 0;
        }
        public int GetTotalDayByEmployeeIDAndToMonthAndYear(int iEmployeeID, int iMonth, int iYear)
        {
            string sql = string.Format(@"SELECT SUM(ISNULL(HREmployeeAnnualRegTotalDay,0))
                                            FROM dbo.HREmployeeAnnualRegs
                                            WHERE AAStatus='Alive' 
                                            AND FK_HREmployeeID={0}
                                            AND HREmployeeAnnualRegMonth={1}
                                            AND HREmployeeAnnualRegYear={2}", iEmployeeID, iMonth, iYear);
            DataSet ds = dal.GetDataSet(sql);
            if (ds != null && ds.Tables.Count > 0 && ds.Tables[0].Rows.Count > 0)
            {
                if (ds.Tables[0].Rows[0][0] != DBNull.Value)
                    return Convert.ToInt32(ds.Tables[0].Rows[0][0]);
                return 0;
            }
            return 0;
        }
    }
	#endregion
}