using System;
using System.Data;
using System.Text;
using System.Collections.Generic;
using ExpertWebLib;


namespace ExpertERP.BusinessEntities
{
    #region ICPromotions
    //-----------------------------------------------------------
    //Generated By: GMC Studio
    //Class:ICPromotionsController
    //Created Date:Tuesday, May 20, 2008
    //-----------------------------------------------------------

    public class ICPromotionsController : BaseBusinessController
    {
        public ICPromotionsController()
        {
            dal = new DALBaseProvider("ICPromotions", typeof(ICPromotionsInfo));
        }

        public DataSet GetPromotionsByCreatedDate(DateTime dtDateFrom, DateTime dtDateTo)
        {
            return dal.GetDataSet("ICPromotions_SelectByCreatedDate", dtDateFrom, dtDateTo);
        }
        public DataSet GetPromotionByUpdateDate(DateTime dtFromDate, DateTime dtToDate)
        {
            string strFormt = "yyyyMMdd";
            string strQuery = String.Format("Select * from ICPromotions where convert(varchar(10),[AAUpdatedDate],112)>=convert(varchar(10),{0},112) and convert(varchar(10),[AAUpdatedDate],112)<=convert(varchar(10),{1},112)", dtFromDate.ToString(strFormt), dtToDate.ToString(strFormt));
            return dal.GetDataSet(strQuery);
        }
        public List<ICPromotionItemDetailsInfo> GetPromotionProductsFromProduct(int iProductID, DateTime dtDate)
        {
            List<ICPromotionItemDetailsInfo> lstICPromotionItemDetailsInfo = new List<ICPromotionItemDetailsInfo>();
            lstICPromotionItemDetailsInfo.Clear();
            
            ICPromotionItemsController objPromotionItemsController = new ICPromotionItemsController();
            ICPromotionItemDetailsController objPromotionItemDetailsController = new ICPromotionItemDetailsController();

            DataSet dsPromotionItems = objPromotionItemsController.GetAllDataByForeignColumn("FK_ICProductID", iProductID);
            if (dsPromotionItems.Tables.Count > 0)
            {
                foreach (DataRow rowPromotionItem in dsPromotionItems.Tables[0].Rows)
                {
                    ICPromotionItemsInfo objPromotionItemsInfo = (ICPromotionItemsInfo)objPromotionItemsController.GetObjectFromDataRow(rowPromotionItem);
                    ICPromotionsInfo objPromotionsInfo = (ICPromotionsInfo)GetObjectByID(objPromotionItemsInfo.FK_ICPromotionID);
                    if (objPromotionsInfo != null)
                        if (objPromotionsInfo.ICPromotionStartDate.Value.CompareTo(dtDate) <= 0 &&
                            objPromotionsInfo.ICPromotionEndDate.Value.CompareTo(dtDate) >= 0)
                        {
                            DataSet dsPromotionItemDetails = objPromotionItemDetailsController.GetAllDataByForeignColumn("FK_ICPromotionItemID", objPromotionItemsInfo.ICPromotionItemID);
                            if (dsPromotionItemDetails.Tables.Count > 0)
                            {
                                foreach (DataRow rowDetail in dsPromotionItemDetails.Tables[0].Rows)
                                {
                                    ICPromotionItemDetailsInfo objPromotionItemDetailsInfo = (ICPromotionItemDetailsInfo)objPromotionItemDetailsController.GetObjectFromDataRow(rowDetail);
                                    lstICPromotionItemDetailsInfo.Add(objPromotionItemDetailsInfo);
                                }
                            }
                        }
                }
            }

            return lstICPromotionItemDetailsInfo;
        }
    }
    #endregion
}