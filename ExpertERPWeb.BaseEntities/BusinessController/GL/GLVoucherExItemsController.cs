using System;
using System.Data;
using System.Text;
using System.Collections.Generic;
using ExpertWebLib;
namespace ExpertERP.BusinessEntities
{
	#region GLVoucherExItems
	//-----------------------------------------------------------
	//Generated By: GMC Studio
	//Class:GLVoucherExItemsController
	//Created Date:Tuesday, June 10, 2014
	//-----------------------------------------------------------
	
	public class GLVoucherExItemsController:BaseBusinessController
	{
		public GLVoucherExItemsController()
		{
			dal= new DALBaseProvider("GLVoucherExItems",typeof(GLVoucherExItemsInfo));
		}
        public void DeleteByModuleNameAndVoucherID(string psSourceLedger, int piFK_GLVoucherID)
        {
            String strQuery = String.Format(@"SELECT * FROM  FROM GLVoucherExItems
                            WHERE AAStatus = 'Alive'
                            AND GLVoucherExItemSourceLedger = '{0}'
                            AND FK_GLVoucherID = {1}", psSourceLedger, piFK_GLVoucherID);
            
            dal.GetDataSet(strQuery);
        }
        public DataSet GetAllDataByAccount(string psGLAccountNo, DateTime pdtFrom, DateTime pdtTo, String psObjKey = "")
        {
            if (psObjKey.Trim().Length > 0)
                psObjKey = " AND " + psObjKey;
            String strInRange = DALUtil.GenerateBeetween("GLVoucherExItemDate", pdtFrom, pdtTo);

            String strQuery = String.Format(@"
                                    SELECT 
                                    0 AS ViewAccountDoiUngID,
                                    b.GLAccountID AS AccountID,
                                    b.GLAccountNo AS AccountNo,
                                    '' AS AccountDoiUngName,
                                    GLVoucherExItemDebitAmt AS DebitAmt,
                                    GLVoucherExItemDebitFAmt AS DebitFAmt,
                                    GLVoucherExItemCreditAmt AS CreditAmt,
                                    GLVoucherExItemCreditFAmt AS CreditFAmt,
                                    GLVoucherExItemDate  AS  JournalDate,
                                    GLVoucherExItemNo AS DocumentNo,
                                    GLVoucherExItemSourceLedger AS SourceLedger,
                                    '' AS AccountDoiUngNo,
                                    FK_GECurrencyID AS FK_GECurrencyID,
                                    GLVoucherExItemExRate AS ExcRate,
                                    FK_ICProductID AS FK_ICProductID,
                                    GLVoucherExItemDesc as JournalDesc,
                                    GLVoucherExItemHDesc as JournalHDesc
                                    FROM GLVoucherExItems a
                                        INNER JOIN GLAccounts b ON a.AAStatus = 'Alive' AND b.AAStatus = 'Alive' AND a.FK_GLAccountID = b.GLAccountID
                                    WHERE {0}
                                    AND b.GLAccountNo like '{1}%'
                                    {2}
                                    /*GROUP BY 
                                    b.GLAccountID ,
                                    b.GLAccountNo,
                                    --CreditAccount.GLAccountName,
                                    GLVoucherExItemDate  ,
                                    GLVoucherExItemNo,
                                    GLVoucherExItemSourceLedger,
                                    --CreditAccount.GLAccountNo,
                                    FK_GECurrencyID,
                                    GLVoucherExItemExRate,
                                    FK_ICProductID*/
                                    ", strInRange, psGLAccountNo, psObjKey);

            return dal.GetDataSet(strQuery);
        }
	}
	#endregion
}