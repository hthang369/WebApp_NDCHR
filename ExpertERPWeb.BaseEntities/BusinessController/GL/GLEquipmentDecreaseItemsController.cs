using System;
using System.Data;
using System.Text;
using System.Collections.Generic;
using ExpertWebLib;
namespace ExpertERP.BusinessEntities
{
	#region GLEquipmentDecreaseItems
	//-----------------------------------------------------------
	//Generated By: GMC Studio
	//Class:GLEquipmentDecreaseItemsController
	//Created Date:Thursday, December 15, 2011
	//-----------------------------------------------------------
	
	public class GLEquipmentDecreaseItemsController:BaseBusinessController
	{
		public GLEquipmentDecreaseItemsController()
		{
			dal= new DALBaseProvider("GLEquipmentDecreaseItems",typeof(GLEquipmentDecreaseItemsInfo));
		}
        public double GetAmtByGLEquip(int iEquipAllocateID)
        {
            return GetSumColAmtByEquipAllocate(iEquipAllocateID, DateTime.MaxValue, "GLEquipmentDecreaseItemAmt");
        }
        public double GetAmtByGLEquip(int iEquipAllocateID, DateTime dtTo)
        {
            return GetSumColAmtByEquipAllocate(iEquipAllocateID, dtTo, "GLEquipmentDecreaseItemAmt");
        }
        public int GetQtyByGLEquip(int iEquipAllocateID)
        {
            return GetQtyByGLEquip(iEquipAllocateID, DateTime.MaxValue);
        }
        public int GetQtyByGLEquip(int iEquipAllocateID, DateTime dtTo)
        {
            return (int)GetSumColAmtByEquipAllocate(iEquipAllocateID, dtTo, "GLEquipmentDecreaseItemQty");
        }
        public int GetLifeByGLEquip(int iEquipAllocateID)
        {
            return GetLifeByGLEquip(iEquipAllocateID, DateTime.MaxValue);
        }
        public int GetLifeByGLEquip(int iEquipAllocateID, DateTime dtTo)
        {
            return (int)GetSumColAmtByEquipAllocate(iEquipAllocateID, dtTo, "GLEquipmentDecreaseItemLife");
        }
        public double GetSumColAmtByEquipAllocate(int iEquipAllocateID, DateTime dtTo, string sColAmt)
        {
            String str = String.Format(@"SELECT SUM({1})
FROM GLEquipmentDecreaseItems a 
INNER JOIN GLEquipmentDecreases b ON a.FK_GLEquipmentDecreaseID = b.GLEquipmentDecreaseID
    AND a.AAStatus='Alive' AND b.AAStatus='Alive'
    AND FK_GLEquipmentAllocateID={0}
", iEquipAllocateID, sColAmt);
            if (dtTo < DateTime.MaxValue & dtTo > DateTime.MinValue)
            {
                str += string.Format(@" AND GLEquipmentDecreaseDate <= '{0}'", dtTo.ToString("yyyyMMdd"));
            }
            DataSet ds = dal.GetDataSet(str);
            if (ds != null && ds.Tables.Count > 0 && ds.Tables[0].Rows.Count > 0 && ds.Tables[0].Rows[0][0] != DBNull.Value)
            {
                return double.Parse(ds.Tables[0].Rows[0][0].ToString());
            }
            return 0;
        }

        //V.Hung add 24/08/2015
        public DataSet GetAllDataByProduct(int iICProductID)
        {
            string strQuery = string.Format(@"SELECT  dbo.GLEquipmentDecreaseItems.*
                                    FROM    dbo.GLEquipmentDecreaseItems
                                            INNER JOIN dbo.GLEquipmentDecreases ON dbo.GLEquipmentDecreaseItems.FK_GLEquipmentDecreaseID = dbo.GLEquipmentDecreases.GLEquipmentDecreaseID
                                                AND dbo.GLEquipmentDecreaseItems.AAStatus = 'Alive'
                                                AND dbo.GLEquipmentDecreases.AAStatus = 'Alive'
                                                AND FK_ICProductID = {0}", iICProductID);
            return GetDataSet(strQuery);
        }
	}
	#endregion
}