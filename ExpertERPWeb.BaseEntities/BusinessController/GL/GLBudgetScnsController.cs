using System;
using System.Data;
using System.Text;
using System.Collections.Generic;
using ExpertWebLib;
namespace ExpertERP.BusinessEntities
{
	#region GLBudgetScns
	//-----------------------------------------------------------
	//Generated By: GMC Studio
	//Class:GLBudgetScnsController
	//Created Date:21 Tháng Tám 2012
	//-----------------------------------------------------------
	
	public class GLBudgetScnsController:BaseBusinessController
	{
		public GLBudgetScnsController()
		{
			dal= new DALBaseProvider("GLBudgetScns",typeof(GLBudgetScnsInfo));
		}
        public DataSet GetAllBudgetScnByYear(int iYear)
        {
            String str = String.Format(@"SELECT * FROM GLBudgetScns WHERE AAStatus='Alive' AND GLBudgetScnYear={0}",iYear);
            return dal.GetDataSet(str);
        }
        public void UpdateAmtTotal(int IBudgetScnID)
        {
            String str = String.Format(@"SELECT SUM(GLBudgetScnItemEstAmtTot) AS EST, SUM(GLBudgetScnItemActAmtTot) AS ACT FROM dbo.GLBudgetScnItems
                                        WHERE AAStatus = 'Alive'
                                        AND FK_GLBudgetScnID={0} ", IBudgetScnID);
            DataSet ds = dal.GetDataSet(str);
            if (ds != null && ds.Tables.Count > 0 && ds.Tables[0].Rows.Count > 0)
            {
                GLBudgetScnsController BudgetScnCtrl=new GLBudgetScnsController();
                GLBudgetScnsInfo BudgetScnInfo = (GLBudgetScnsInfo)BudgetScnCtrl.GetObjectByID(IBudgetScnID);
                if (BudgetScnInfo != null)
                {
                    if (ds.Tables[0].Rows[0][0] != DBNull.Value)
                    {
                        BudgetScnInfo.GLBudgetScnEstAmtTot = double.Parse(ds.Tables[0].Rows[0][0].ToString());
                    }

                    if (ds.Tables[0].Rows[0][1] != DBNull.Value)
                    {
                        BudgetScnInfo.GLBudgetScnActAmtTot = double.Parse(ds.Tables[0].Rows[0][1].ToString());
                    }
                    BudgetScnCtrl.UpdateObject(BudgetScnInfo);
                }
            }
        }
	}
	#endregion
}