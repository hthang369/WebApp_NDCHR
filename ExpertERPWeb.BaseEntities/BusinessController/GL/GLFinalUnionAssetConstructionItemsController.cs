using System;
using System.Data;
using System.Text;
using System.Collections.Generic;
using ExpertWebLib;
namespace ExpertERP.BusinessEntities
{
	#region GLFinalUnionAssetConstructionItems
	//-----------------------------------------------------------
	//Generated By: GMC Studio
	//Class:GLFinalUnionAssetConstructionItemsController
	//Created Date:Saturday, March 21, 2015
	//-----------------------------------------------------------
	
	public class GLFinalUnionAssetConstructionItemsController:BaseBusinessController
	{
		public GLFinalUnionAssetConstructionItemsController()
		{
			dal= new DALBaseProvider("GLFinalUnionAssetConstructionItems",typeof(GLFinalUnionAssetConstructionItemsInfo));
		}

        /// <summary>
        /// Viet Nguyen 2015.03.28
        /// Lấy danh sách các phiếu tập hợp chưa được thanh toán
        /// </summary>
        /// <returns></returns>
        public DataSet GetAllDataExistFinalUnionAmt()
        {
            string strQuery = string.Format(@"SELECT  GLUnionAssetConstructionItems.*,GLFinalUnionAssetConstructionItems.GLFinalUnionAssetConstructionItemUnionFinalAmt
                                            ,GLFinalUnionAssetConstructionItems.GLFinalUnionAssetConstructionItemUnionFinalFAmt
                                            FROM    ( SELECT    FK_FAAssetConstructionID ,
                                                                SUM(GLUnionAssetConstructionItemUnionAmt) AS GLFinalUnionAssetConstructionItemUnionAmt,
					                                            SUM(GLUnionAssetConstructionItemUnionFAmt) AS GLFinalUnionAssetConstructionItemUnionFAmt
                                                      FROM      dbo.GLUnionAssetConstructionItems
                                                      WHERE     AAStatus = 'Alive'
                                                                AND FK_FAAssetConstructionID > 0
                                                      GROUP BY  FK_FAAssetConstructionID
                                                    ) AS GLUnionAssetConstructionItems
                                                    LEFT JOIN ( SELECT  FK_FAAssetConstructionID ,
                                                                        SUM(GLFinalUnionAssetConstructionItemFinalAmt) AS GLFinalUnionAssetConstructionItemUnionFinalAmt,
                                                                        SUM(GLFinalUnionAssetConstructionItemFinalFAmt) AS GLFinalUnionAssetConstructionItemUnionFinalFAmt
                                                                FROM    dbo.GLFinalUnionAssetConstructionItems
                                                                WHERE   GLFinalUnionAssetConstructionItems.AAStatus = 'Alive'
                                                                GROUP BY FK_FAAssetConstructionID
                                                              ) AS GLFinalUnionAssetConstructionItems ON GLFinalUnionAssetConstructionItems.FK_FAAssetConstructionID = GLUnionAssetConstructionItems.FK_FAAssetConstructionID
                                            WHERE   GLFinalUnionAssetConstructionItemUnionFinalAmt IS NULL
                                                    OR ( GLFinalUnionAssetConstructionItemUnionAmt
                                                                 - GLFinalUnionAssetConstructionItemUnionFinalAmt > 0 )                                                          
                                             ");
            return dal.GetDataSet(strQuery);
        }
	}
	#endregion
}