using System;
using System.Data;
using System.Text;
using System.Collections.Generic;
using ExpertWebLib;
namespace ExpertERP.BusinessEntities
{
	#region GLEquipmentInitJournals
	//-----------------------------------------------------------
	//Generated By: Expert Studio
	//Class:GLEquipmentInitJournalsController
	//Created Date:Tuesday, June 2, 2015
	//-----------------------------------------------------------
	
	public class GLEquipmentInitJournalsController:BaseBusinessController
	{
		public GLEquipmentInitJournalsController()
		{
			dal= new DALBaseProvider("GLEquipmentInitJournals",typeof(GLEquipmentInitJournalsInfo));
		}

        public double GetTotalEquipmentInitJournalAmtByJournalID(int iGLJournalID)
        {
            double dbTotalEquipmentInitJournalAmount = 0;
            String strQuery = String.Format("Select Sum([FAAssetInitJournalAmt]) From [GLEquipmentInitJournals] Where [FK_GLJournalID]={0}", iGLJournalID);
            DataSet ds = GetDataSet(strQuery);
            if (ds != null)
            {
                if (ds.Tables[0] != null)
                {
                    if (ds.Tables[0].Rows.Count > 0)
                    {
                        dbTotalEquipmentInitJournalAmount = Convert.ToDouble(ds.Tables[0].Rows[0][0]);
                    }
                }
            }

            return dbTotalEquipmentInitJournalAmount;
        }
        public void DeleteInitJournalByProductID(int ProductID)
        {
            string strSQL = string.Format(@"
UPDATE GLEquipmentInitJournals 
    SET FK_GLJournalID = null, GLJournalDocumentNo = null, GLSourceLedger = null
    WHERE FK_ICProductID = {0} AND AAStatus <> 'Alive'"
                , ProductID);
            dal.RunQuery(strSQL);
        }

        //Thang - 28/10/2015 Get Data Init Equipment
        public DataSet GetDataJournalInitEquipment(int iDebitAccountID)
        {
            string strQuery = string.Format(@"SELECT c.AASelected,FK_GLJournalID,c.FK_ICProductID,c.FK_GECurrencyID,
                                                    c.GLJournalExRate as GLEquipmentInitJournalExRate,e.FK_ICStkUOMID as FK_ICUOMID,
                                                    d.GLEquipmentInitJournalAmt,d.GLEquipmentInitJournalFAmt,d.GLEquipmentInitJournalQty,
                                                    d.GLEquipmentInitJournalAmt as GLEquipmentInitJournalOrgAmt,
                                                    d.GLEquipmentInitJournalFAmt as GLEquipmentInitJournalOrgFAmt,
                                                    d.GLEquipmentInitJournalRAmt,
                                                    d.GLEquipmentInitJournalRFAmt,
                                                    c.GLJournalDocumentNo, c.GLSourceLedger
                                            FROM GLJournals as c JOIN 
                                                (SELECT a.GLJournalNo,Max(GLJournalID) as FK_GLJournalID,
                                                sum(GLJournalAmt) as GLEquipmentInitJournalAmt, 
                                                sum(GLJournalFAmt) as GLEquipmentInitJournalFAmt, 
                                                sum(GLJournalItemQty) as GLEquipmentInitJournalQty,
                                                sum(GLJournalAmt) - sum(isnull(GLEquipmentInitJournalAmt,0)) as GLEquipmentInitJournalRAmt,
                                                sum(GLJournalFAmt) - sum(isnull(GLEquipmentInitJournalFAmt,0)) as GLEquipmentInitJournalRFAmt
                                                FROM GLJournals as a LEFT JOIN GLEquipmentInitJournals as b ON a.GLJournalNo = b.GLJournalDocumentNo
                                                WHERE FK_GLDebitAccountID = '{0}'
                                                GROUP BY a.GLJournalNo,a.GLSourceLedger
                                                HAVING (sum(a.GLJournalAmt) - sum(isnull(b.GLEquipmentInitJournalAmt,0))) > 0) as d
                                            ON c.GLJournalID = d.FK_GLJournalID
                                            JOIN ICProducts as e ON c.FK_ICProductID = e.ICProductID", iDebitAccountID);
            return GetDataSet(strQuery);
        }
	}
	#endregion
}