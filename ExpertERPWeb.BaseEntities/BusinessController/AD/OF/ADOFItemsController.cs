using System;
using System.Data;
using System.Text;
using System.Collections.Generic;
using ExpertWebLib;
namespace ExpertERP.BusinessEntities
{
	#region ADOFItems
	//-----------------------------------------------------------
	//Generated By: GMC Studio
	//Class:ADOFItemsController
	//Created Date:30 Tháng Sáu 2014
	//-----------------------------------------------------------

    public class ADOFItemsController : BaseBusinessController
	{
		public ADOFItemsController()
		{
			dal= new DALBaseProvider("ADOFItems",typeof(ADOFItemsInfo));
        }

        #region Kiểm tra có tồn tại chi tiết mã phân loại theo đối tượng cha và Mã số --Vinh

        public ADOFItemsInfo CheckExistByParentANDNo(int iADOFID, String strADOFItemNo)
        {
            String str = String.Format(@"   SELECT * FROM dbo.ADOFItems
                                            WHERE AAStatus = 'Alive'
                                            AND FK_ADOFID = {0}
                                            AND ADOFItemNo LIKE '{1}'"
                                    , iADOFID, strADOFItemNo);
            DataSet ds = dal.GetDataSet(str);
            if(ds!= null && ds.Tables.Count > 0 && ds.Tables[0].Rows.Count > 0)
            {
                return (ADOFItemsInfo)dal.GetObjectFromDataRow(ds.Tables[0].Rows[0]);
            }
            return null;
        }

        public DataSet GetOFByListOFProduct(List<BusinessObject>lstOF)
        {
            string strOF = "";
            String strQueryOF = "";

            foreach (ICProductsInfo objICProducts in lstOF)
            {
                if (objICProducts.ICProductIOF01Combo != "")
                    strOF = getValueSearch(strOF, objICProducts.ICProductIOF01Combo);

                if (objICProducts.ICProductIOF02Combo != "")
                    strOF = getValueSearch(strOF, objICProducts.ICProductIOF02Combo);

                if (objICProducts.ICProductIOF03Combo != "")
                    strOF = getValueSearch(strOF, objICProducts.ICProductIOF03Combo);

                if (objICProducts.ICProductIOF04Combo != "")
                    strOF = getValueSearch(strOF, objICProducts.ICProductIOF04Combo);

                if (objICProducts.ICProductIOF05Combo != "")
                    strOF = getValueSearch(strOF, objICProducts.ICProductIOF05Combo);

                if (objICProducts.ICProductIOF06Combo != "")
                    strOF = getValueSearch(strOF, objICProducts.ICProductIOF06Combo);

                if (objICProducts.ICProductIOF07Combo != "")
                    strOF = getValueSearch(strOF, objICProducts.ICProductIOF07Combo);

                if (objICProducts.ICProductIOF08Combo != "")
                    strOF = getValueSearch(strOF, objICProducts.ICProductIOF08Combo);

                if (objICProducts.ICProductIOF09Combo != "")
                    strOF = getValueSearch(strOF, objICProducts.ICProductIOF09Combo);
                if (objICProducts.ICProductIOF10Combo != "")
                    strOF = getValueSearch(strOF, objICProducts.ICProductIOF10Combo);
            } 

            String str = String.Format(@"   SELECT ADOFs.*
                                            FROM  dbo.ADOFs INNER JOIN dbo.ADOFItems ON dbo.ADOFs.ADOFID = dbo.ADOFItems.FK_ADOFID
                                            WHERE ADOFs.AAStatus = 'Alive' AND ADOFItems.AAStatus = 'Alive'
                                                  {0} ", strQueryOF 
                                      );
            DataSet ds = dal.GetDataSet(str);
          
            return ds;
        }

        public String getValueSearch(String strOF, String strValue)
        {
            if (string.IsNullOrEmpty(strOF))
            {
                strOF += String.Format(@"AND ADOFItemNo LIKE N'{0}' ", strValue);
            }
            else
            {
                strOF += String.Format(@"OR ADOFItemNo LIKE N'{0}' ", strValue);
            }

            return strOF;
        }

        #endregion

        //(Thang - 10/9/2015 load ADOFItemNo theo loại nghiệp vụ và ADOFID
        public ADOFItemsInfo GetOFItemNo(int TranCfgID, string OFNo)
        {
            string strQuery = string.Format(@"select ADOFItems.* 
                                              from ADOFItems join GLTranCfgTCodes on ADOFItemID = FK_ADOFItemID
                                                 where FK_GLTranCfgID = {0} and GLTranCfgTCodes.FK_ADOFID = (select ADOFID from ADOFs where ADOFNo like '%{1}%')", TranCfgID, OFNo);
            DataSet ds = dal.GetDataSet(strQuery);
            if (ds != null && ds.Tables.Count > 0 && ds.Tables[0].Rows.Count > 0)
            {
                return (ADOFItemsInfo)dal.GetObjectFromDataRow(ds.Tables[0].Rows[0]);
            }
            return null;
        }
        //)

        //(V.Hung add 07/10/2015 Kiểm tra tồn tại mã phân tích theo loại mã Ocode
        public bool IsExistByADOFNoANDADOFItemNO(string strADOFNo, string strADOFItemNo)
        {
            string strQuery = string.Format(@"SELECT  *
                                            FROM    dbo.ADOFItems
                                                    INNER JOIN dbo.ADOFs ON dbo.ADOFItems.FK_ADOFID = dbo.ADOFs.ADOFID
                                                                            AND ADOFNo = '{0}'
                                                                            AND dbo.ADOFItems.ADOFItemNo='{1}'", strADOFNo, strADOFItemNo);
            DataSet ds = GetDataSet(strQuery);
            if (ds != null && ds.Tables.Count > 0 && ds.Tables[0].Rows.Count > 0)
            {
                return true;
            }
            return false;
        }
        //)
        // NhamNDH add -28/11/2016- Move Phiếu sản xuất từ CHF
        public string GetADOFItemNameANDADOFItemNO(string strADOFNo, string strADOFItemNo)
        {
            string strQuery = string.Format(@"SELECT  *
                                            FROM    dbo.ADOFItems
                                                    INNER JOIN dbo.ADOFs ON dbo.ADOFItems.FK_ADOFID = dbo.ADOFs.ADOFID
                                                                            AND ADOFNo = '{0}'
                                                                            AND dbo.ADOFItems.ADOFItemNo='{1}'", strADOFNo, strADOFItemNo);
            DataSet ds = GetDataSet(strQuery);
            if (ds != null && ds.Tables.Count > 0 && ds.Tables[0].Rows.Count > 0)
            {
                return ds.Tables[0].Rows[0]["ADOFItemName"].ToString();
            }
            return "";
        }
        //

        public DataSet GetDataByADOF(int iADOFID)
        {
            String str = string.Format(@"SELECT ADOFItemID, ADOFItemNo, ADOFItemName FROM ADOFItems WHERE AAStatus = 'Alive' AND FK_ADOFID = {0}", iADOFID);
            return dal.GetDataSet(str);
        }

    }
	#endregion
}