using System;
using System.Data;
using System.Text;
using System.Collections.Generic;
using ExpertWebLib;
namespace ExpertERP.BusinessEntities
{
	#region ADDocHistorys
	//-----------------------------------------------------------
	//Generated By: GMC Studio
	//Class:ADDocHistorysController
	//Created Date:03 Tháng Bảy 2012
	//-----------------------------------------------------------
	
	public class ADDocHistorysController:BaseBusinessController
	{
		public ADDocHistorysController()
		{
			dal= new DALBaseProvider("ADDocHistorys",typeof(ADDocHistorysInfo));
		}

        public DataSet GetAllDocHistoryByDocTypeAndDocNo(String strDocType, String strDocNo)
        {
            String strQuery = String.Format(@"SELECT * FROM ADDocHistorys WHERE DocType = '{0}' AND DocNo = '{1}'", strDocType, strDocNo);

            return dal.GetDataSet(strQuery);
        }

        public DataSet GetAllDocHistoryByDocTypeAndDocNoAndObjectIDAndTableAndApprovalType(String strDocType, String strDocNo, int iObjectID, string strTableName, string strADApprovalTypeCombo)
        {
            String strQuery = String.Format(@"  SELECT  *
                                                FROM    ADDocHistorys
                                                WHERE   DocType = '{0}'
                                                        AND DocNo = '{1}'
		                                                AND ObjectID = {2}
		                                                AND TableName = '{3}'
		                                                AND ADApprovalTypeCombo = '{4}'"
                                                , strDocType, strDocNo, iObjectID, strTableName, strADApprovalTypeCombo);
            return dal.GetDataSet(strQuery);
        }

        public ADDocHistorysInfo GetLastDocHistory(String strDocType, String strDocNo, int iObjectID, string strTableName, string strADApprovalTypeCombo, int iADApprovalProcID)
        {
            String strQuery = String.Format(@"  SELECT  *
                                                FROM    ADDocHistorys
                                                WHERE   DocType = '{0}'
                                                        AND DocNo = '{1}'
		                                                AND ObjectID = {2}
		                                                AND TableName = '{3}'
		                                                AND ADApprovalTypeCombo = '{4}'
                                                        AND FK_ADApprovalProcID = {5}
                                                ORDER BY ADDocHistoryID DESC"
                                                , strDocType, strDocNo, iObjectID, strTableName, strADApprovalTypeCombo, iADApprovalProcID);
            DataSet dsADDocHistorys = dal.GetDataSet(strQuery);
            List<BusinessObject> lstADDocHistorys = GetListFromDataset(dsADDocHistorys);
            if (lstADDocHistorys.Count > 0)
                return (ADDocHistorysInfo)lstADDocHistorys[0];

            return null;
        }

        public bool UpdateActionDocHistory(string strDocType, int iObjectID, DateTime dtDate, string strApproval = "Approved")
        {
            string strDate = DALUtil.GennerateCondition("Date", CompareType.LessEqualThan, dtDate);
            string strQuery = string.Format(@"UPDATE ADDocHistorys SET Action = '{0}' 
                                                WHERE ObjectID = {1} AND DocType = '{2}' 
                                                        AND {3}", strApproval, iObjectID, strDocType, strDate);
            GetDataSet(strQuery);
            return true;
        }
	}
	#endregion
}