using System;
using System.Data;
using System.Text;
using System.Collections.Generic;
using ExpertWebLib;
namespace ExpertERP.BusinessEntities
{
    #region GEPolicyItems
    //-----------------------------------------------------------
    //Generated By: GMC Studio
    //Class:GEPolicyItemsController
    //Created Date:Thursday, November 26, 2015
    //-----------------------------------------------------------

    public class GEPolicyItemsController : BaseBusinessController
    {
        public GEPolicyItemsController()
        {
            dal = new DALBaseProvider("GEPolicyItems", typeof(GEPolicyItemsInfo));
        }

        public DataSet GetAllObjectByForiegnKeyPolicy_PolicyDefineCalc(int iGEPolicyID, int iGEPolicyDefineCalcID)
        {
            String strQuery = String.Format(@"  SELECT GEPolicyItems.*
                                                FROM dbo.GEPolicys INNER JOIN dbo.GEPolicyDefineCalcs ON GEPolicyDefineCalcs.FK_GEPolicyID = GEPolicys.GEPolicyID
				                                                   INNER JOIN dbo.GEPolicyItems ON GEPolicyItems.FK_GEPolicyDefineCalcID = GEPolicyDefineCalcs.GEPolicyDefineCalcID
                                                WHERE GEPolicys.AAStatus = 'Alive' AND dbo.GEPolicyItems.AAStatus ='Alive' AND GEPolicyDefineCalcs.AAStatus ='Alive'
                                                      AND (GEPolicys.GEPolicyID =  {0} OR 0 = {0})
	                                                  AND (GEPolicyDefineCalcs.GEPolicyDefineCalcID = {1} OR 0 = {1})", iGEPolicyID, iGEPolicyDefineCalcID);

            DataSet ds = GetDataSet(strQuery);
            return ds;
        }

        public DataSet LayDanhSachDoiTuongChinhSachTinhKetQua(String strObject, String strPolicyDefine, String strFromTo, String strTypeApprove, String strSeller)
        {
            if (strTypeApprove == "")
            {
                strTypeApprove = "AND (GEPolicyItems.GEPolicyItemObjectApproveCombo = 'Postpone' OR GEPolicyItems.GEPolicyItemObjectApproveCombo = 'Approved')";
            }
            String strQuery = String.Format(@" 
                                                SELECT GEPolicys.GEPolicyID AS FK_GEPolicyID,
                                                       GEPolicyDefineCalcs.GEPolicyDefineCalcID AS FK_GEPolicyDefineCalcID, 
                                                       GEPolicyDefineCalcs.FK_GEPolicyDefineID,
                                                       GEPolicyItems.FK_GLObjectID,
                                                       GEPolicyItems.FK_GEPolicyDefineCfgItemID,
                                                       GEPolicyItems.FK_GEPolicyDefineOtherAgreeItemID,
                                                       GEPolicyItems.FK_ARCodeTransferItemID
                                                FROM dbo.GEPolicys INNER JOIN dbo.GEPolicyDefineCalcs ON GEPolicyDefineCalcs.FK_GEPolicyID = GEPolicys.GEPolicyID
                                                                   INNER JOIN dbo.GEPolicyItems ON GEPolicyItems.FK_GEPolicyDefineCalcID = GEPolicyDefineCalcs.GEPolicyDefineCalcID
				                                                   INNER JOIN dbo.GEPolicyItemMths ON GEPolicyItemMths.FK_GEPolicyItemID = GEPolicyItems.GEPolicyItemID
																   INNER JOIN dbo.GLObjects ON GLObjects.GLObjectID = GEPolicyItems.FK_GLObjectID
																   INNER JOIN dbo.ARCustomers ON ARCustomers.ARCustomerID= GLObjects.FK_ObjectRefID
																   INNER JOIN dbo.ARSellers ON ARSellers.ARSellerID = ARCustomers.FK_ARSellerID
                                                WHERE GEPolicyItems.AAStatus = 'Alive' AND GEPolicys.AAStatus = 'Alive' AND GEPolicyDefineCalcs.AAStatus = 'Alive' AND ARCustomers.AAStatus = 'Alive' AND ARSellers.AAStatus = 'Alive' AND GLObjects.AAStatus = 'Alive' 
                                                      {0}
	                                                  {1}
                                                      {2}
                                                      {3}
                                                      {4}
                                                GROUP BY GEPolicys.GEPolicyID,GEPolicyDefineCalcs.GEPolicyDefineCalcID,GEPolicyDefineCalcs.FK_GEPolicyDefineID,GEPolicyItems.FK_GLObjectID,GEPolicyItems.FK_GEPolicyDefineCfgItemID,GEPolicyItems.FK_GEPolicyDefineOtherAgreeItemID,GEPolicyItems.FK_ARCodeTransferItemID
                                             ", strObject, strPolicyDefine, strFromTo, strTypeApprove, strSeller);

            DataSet ds = GetDataSet(strQuery);
            return ds;
        }

        public DataSet LayDanhSachDoiTuongChinhSachTinhKetQuaByVot(String strObject, String strPolicyDefine, String strFromTo, String strTypeApprove, String strSeller)
        {
            if (strTypeApprove == "")
            {
                strTypeApprove = "AND (GEPolicyItems.GEPolicyItemObjectApproveCombo = 'Postpone' OR GEPolicyItems.GEPolicyItemObjectApproveCombo = 'Approved')";
            }
            String strQuery = String.Format(@" 
                                                SELECT  GEPolicys.GEPolicyID AS FK_GEPolicyID ,
                                                        GEPolicyDefineCalcs.GEPolicyDefineCalcID AS FK_GEPolicyDefineCalcID ,
                                                        GEPolicyDefineCalcs.FK_GEPolicyDefineID AS FK_GEPolicyDefineID ,
                                                        GEPolicyItems.FK_GLObjectID AS FK_GLObjectID,
                                                        GEPolicyItems.FK_GEPolicyDefineCfgItemID  AS FK_GEPolicyDefineCfgItemID,
                                                        GEPolicyItems.FK_GEPolicyDefineOtherAgreeItemID  AS FK_GEPolicyDefineOtherAgreeItemID,
                                                        GEPolicyItems.FK_ARCodeTransferItemID  AS FK_ARCodeTransferItemID,
                                                        GEPolicyItems.GEPolicyItemObjectApproveCombo AS ViewPolicyDefineStatisticNo,
                                                        GEPolicyItems.GEPolicyItemDesc AS ViewPolicyDefineStatisticDesc, 
                                                        GEPolicyItemMths.GEPolicyItemMthFAmt AS value ,
                                                        GEPolicyDefineMthCfgs.GEPolicyDefineMthCfgMapTypeCombo AS ViewPolicyDefineStatisticTypeCombo 
                                                INTO    #Result
                                                   
                                                FROM    dbo.GEPolicys
                                                        INNER JOIN dbo.GEPolicyDefineCalcs ON GEPolicyDefineCalcs.FK_GEPolicyID = GEPolicys.GEPolicyID
                                                        INNER JOIN dbo.GEPolicyItems ON GEPolicyItems.FK_GEPolicyDefineCalcID = GEPolicyDefineCalcs.GEPolicyDefineCalcID
                                                        INNER JOIN dbo.GEPolicyItemMths ON GEPolicyItemMths.FK_GEPolicyItemID = GEPolicyItems.GEPolicyItemID
                                                        INNER JOIN dbo.GLObjects ON GLObjects.GLObjectID = GEPolicyItems.FK_GLObjectID
                                                        INNER JOIN dbo.ARCustomers ON ARCustomers.ARCustomerID = GLObjects.FK_ObjectRefID
                                                        
                                                        INNER JOIN dbo.GEPolicyDefines ON GEPolicyDefines.GEPolicyDefineID = GEPolicyDefineCalcs.FK_GEPolicyDefineID
                                                        INNER JOIN dbo.GEPolicyDefineMths ON GEPolicyDefineMths.GEPolicyDefineMthID = GEPolicyItemMths.FK_GEPolicyDefineMthID
                                                        INNER JOIN dbo.GEPolicyDefineMthCfgs ON GEPolicyDefineMthCfgs.GEPolicyDefineMthCfgID = GEPolicyDefineMths.FK_GEPolicyDefineMthCfgID
                                                WHERE   GEPolicyItems.AAStatus = 'Alive'
                                                        AND GEPolicys.AAStatus = 'Alive'
                                                        AND GEPolicyDefineCalcs.AAStatus = 'Alive'
                                                        AND ARCustomers.AAStatus = 'Alive'
                                                        
                                                        AND GLObjects.AAStatus = 'Alive'
                                                        AND GEPolicys.AAStatus = 'Alive'
                                                        AND GEPolicyDefineMths.AAStatus = 'Alive'
                                                        AND GEPolicyDefineMthCfgs.AAStatus = 'Alive'

                                                        {0}
                                                        {1}
                                                        {2}
                                                        {3}
                                                        {4}

                                                  AND GEPolicyDefineMthCfgs.GEPolicyDefineMthCfgMapTypeCombo <> ''
                                    
                                                DECLARE @col_list NVARCHAR(MAX);
                                                SELECT  @col_list = ISNULL(@col_list + ',', '') -- + QUOTENAME(ViewPolicyDefineStatisticTypeCombo)
                                                       + QUOTENAME(CONVERT(NVARCHAR(100), ViewPolicyDefineStatisticTypeCombo))
                                                FROM    #Result
                                                GROUP BY ViewPolicyDefineStatisticTypeCombo;

                                                IF @col_list IS NULL
                                                    SET @col_list = '';
                                                DECLARE @sql NVARCHAR(MAX);

                                                SELECT  @sql = '

                                                SELECT  FK_GEPolicyID,FK_GEPolicyDefineCalcID, FK_GEPolicyDefineID,FK_GLObjectID, FK_GEPolicyDefineCfgItemID,FK_GEPolicyDefineOtherAgreeItemID,FK_ARCodeTransferItemID,ViewPolicyDefineStatisticNo,ViewPolicyDefineStatisticDesc,' + @col_list  + '
                                                FROM    #Result';
                                                IF @col_list <> ''
                                                    SET @sql = @sql + '
                                                pivot
                                                (
                                                SUM(Value)
                                                FOR ViewPolicyDefineStatisticTypeCombo IN ( ' + @col_list + ')
                                                ) p';
                                                PRINT @sql
                                                EXEC    (@sql);
                                             ", strObject, strPolicyDefine, strFromTo, strTypeApprove, strSeller);

            DataSet ds = GetDataSet(strQuery);
            return ds;
        }

        public DataSet KiemTraKhachHangCoKetQuaTruyVan(String strObject, String strPolicyDefine, String strFromTo, String strTypeApprove, String strSeller)
        {
            if (strTypeApprove == "")
            {
                strTypeApprove = "AND (GEPolicyItems.GEPolicyItemObjectApproveCombo = 'Postpone' OR GEPolicyItems.GEPolicyItemObjectApproveCombo = 'Approved')";
            }
            String strQuery = String.Format(@" 
                                                SELECT  GEPolicys.GEPolicyID AS FK_GEPolicyID ,
                                                        GEPolicyDefineCalcs.GEPolicyDefineCalcID AS FK_GEPolicyDefineCalcID ,
                                                        GEPolicyDefineCalcs.FK_GEPolicyDefineID AS FK_GEPolicyDefineID ,
                                                        GEPolicyItems.FK_GLObjectID AS FK_GLObjectID,
                                                        GEPolicyItems.FK_GEPolicyDefineCfgItemID  AS FK_GEPolicyDefineCfgItemID,
                                                        GEPolicyItems.FK_GEPolicyDefineOtherAgreeItemID  AS FK_GEPolicyDefineOtherAgreeItemID,
                                                        GEPolicyItems.FK_ARCodeTransferItemID  AS FK_ARCodeTransferItemID,
                                                        GEPolicyItems.GEPolicyItemObjectApproveCombo AS ViewPolicyDefineStatisticNo,
                                                        GEPolicyItems.GEPolicyItemDesc AS ViewPolicyDefineStatisticDesc, 
                                                        GEPolicyItemMths.GEPolicyItemMthFAmt AS value ,
                                                        GEPolicyDefineMthCfgs.GEPolicyDefineMthCfgMapTypeCombo AS ViewPolicyDefineStatisticTypeCombo 
                                             
                                                   
                                                FROM    dbo.GEPolicys
                                                        INNER JOIN dbo.GEPolicyDefineCalcs ON GEPolicyDefineCalcs.FK_GEPolicyID = GEPolicys.GEPolicyID
                                                        INNER JOIN dbo.GEPolicyItems ON GEPolicyItems.FK_GEPolicyDefineCalcID = GEPolicyDefineCalcs.GEPolicyDefineCalcID
                                                        INNER JOIN dbo.GEPolicyItemMths ON GEPolicyItemMths.FK_GEPolicyItemID = GEPolicyItems.GEPolicyItemID
                                                        INNER JOIN dbo.GLObjects ON GLObjects.GLObjectID = GEPolicyItems.FK_GLObjectID
                                                        INNER JOIN dbo.ARCustomers ON ARCustomers.ARCustomerID = GLObjects.FK_ObjectRefID
                                                        
                                                        INNER JOIN dbo.GEPolicyDefines ON GEPolicyDefines.GEPolicyDefineID = GEPolicyDefineCalcs.FK_GEPolicyDefineID
                                                        INNER JOIN dbo.GEPolicyDefineMths ON GEPolicyDefineMths.GEPolicyDefineMthID = GEPolicyItemMths.FK_GEPolicyDefineMthID
                                                        INNER JOIN dbo.GEPolicyDefineMthCfgs ON GEPolicyDefineMthCfgs.GEPolicyDefineMthCfgID = GEPolicyDefineMths.FK_GEPolicyDefineMthCfgID
                                                WHERE   GEPolicyItems.AAStatus = 'Alive'
                                                        AND GEPolicys.AAStatus = 'Alive'
                                                        AND GEPolicyDefineCalcs.AAStatus = 'Alive'
                                                        AND ARCustomers.AAStatus = 'Alive'
                                                        
                                                        AND GLObjects.AAStatus = 'Alive'
                                                        AND GEPolicys.AAStatus = 'Alive'
                                                        AND GEPolicyDefineMths.AAStatus = 'Alive'
                                                        AND GEPolicyDefineMthCfgs.AAStatus = 'Alive'

                                                        {0}
                                                        {1}
                                                        {2}
                                                        {3}

                                                  AND GEPolicyDefineMthCfgs.GEPolicyDefineMthCfgMapTypeCombo <> ''
                                    
                                             ", strObject, strPolicyDefine, strFromTo, strTypeApprove, strSeller);

            DataSet ds = GetDataSet(strQuery);
            return ds;
        }

        public DataSet KiemTraThangNamTinhKQCoKetQuaTruyVan(String strObject, String strPolicyDefine, String strFromTo, String strTypeApprove, String strSeller)
        {
            if (strTypeApprove == "")
            {
                strTypeApprove = "AND (GEPolicyItems.GEPolicyItemObjectApproveCombo = 'Postpone' OR GEPolicyItems.GEPolicyItemObjectApproveCombo = 'Approved')";
            }
            String strQuery = String.Format(@" 
                                                SELECT  GEPolicys.GEPolicyID AS FK_GEPolicyID ,
                                                        GEPolicyDefineCalcs.GEPolicyDefineCalcID AS FK_GEPolicyDefineCalcID ,
                                                        GEPolicyDefineCalcs.FK_GEPolicyDefineID AS FK_GEPolicyDefineID ,
                                                        GEPolicyItems.FK_GLObjectID AS FK_GLObjectID,
                                                        GEPolicyItems.FK_GEPolicyDefineCfgItemID  AS FK_GEPolicyDefineCfgItemID,
                                                        GEPolicyItems.FK_GEPolicyDefineOtherAgreeItemID  AS FK_GEPolicyDefineOtherAgreeItemID,
                                                        GEPolicyItems.FK_ARCodeTransferItemID  AS FK_ARCodeTransferItemID,
                                                        GEPolicyItems.GEPolicyItemObjectApproveCombo AS ViewPolicyDefineStatisticNo,
                                                        GEPolicyItems.GEPolicyItemDesc AS ViewPolicyDefineStatisticDesc, 
                                                        GEPolicyItemMths.GEPolicyItemMthFAmt AS value ,
                                                        GEPolicyDefineMthCfgs.GEPolicyDefineMthCfgMapTypeCombo AS ViewPolicyDefineStatisticTypeCombo 
                                             
                                                   
                                                FROM    dbo.GEPolicys
                                                        INNER JOIN dbo.GEPolicyDefineCalcs ON GEPolicyDefineCalcs.FK_GEPolicyID = GEPolicys.GEPolicyID
                                                        INNER JOIN dbo.GEPolicyItems ON GEPolicyItems.FK_GEPolicyDefineCalcID = GEPolicyDefineCalcs.GEPolicyDefineCalcID
                                                        INNER JOIN dbo.GEPolicyItemMths ON GEPolicyItemMths.FK_GEPolicyItemID = GEPolicyItems.GEPolicyItemID
                                                        INNER JOIN dbo.GLObjects ON GLObjects.GLObjectID = GEPolicyItems.FK_GLObjectID
                                                        INNER JOIN dbo.ARCustomers ON ARCustomers.ARCustomerID = GLObjects.FK_ObjectRefID
                                                        
                                                        INNER JOIN dbo.GEPolicyDefines ON GEPolicyDefines.GEPolicyDefineID = GEPolicyDefineCalcs.FK_GEPolicyDefineID
                                                        INNER JOIN dbo.GEPolicyDefineMths ON GEPolicyDefineMths.GEPolicyDefineMthID = GEPolicyItemMths.FK_GEPolicyDefineMthID
                                                        INNER JOIN dbo.GEPolicyDefineMthCfgs ON GEPolicyDefineMthCfgs.GEPolicyDefineMthCfgID = GEPolicyDefineMths.FK_GEPolicyDefineMthCfgID
                                                WHERE   GEPolicyItems.AAStatus = 'Alive'
                                                        AND GEPolicys.AAStatus = 'Alive'
                                                        AND GEPolicyDefineCalcs.AAStatus = 'Alive'
                                                        AND ARCustomers.AAStatus = 'Alive'
                                                        
                                                        AND GLObjects.AAStatus = 'Alive'
                                                        AND GEPolicys.AAStatus = 'Alive'
                                                        AND GEPolicyDefineMths.AAStatus = 'Alive'
                                                        AND GEPolicyDefineMthCfgs.AAStatus = 'Alive'

                                                        {0}
                                                        {1}
                                                        {2}
                                                        {3}

                                                  AND GEPolicyDefineMthCfgs.GEPolicyDefineMthCfgMapTypeCombo <> ''
                                    
                                             ", strObject, strPolicyDefine, strFromTo, strTypeApprove, strSeller);

            DataSet ds = GetDataSet(strQuery);
            return ds;
        }

        public DataSet LayDanhSachKhachHangTheoQuanLyVung(String strObject, String strPolicyDefine, String strFromTo, String strTypeApprove, String strSeller)
        {
            if (strTypeApprove == "")
            {
                strTypeApprove = "AND (GEPolicyItems.GEPolicyItemObjectApproveCombo = 'Postpone' OR GEPolicyItems.GEPolicyItemObjectApproveCombo = 'Approved')";
            }
            String strQuery = String.Format(@" 
                                                 
                                                SELECT  GEPolicyItems.FK_GLObjectID AS FK_GLObjectID
                                                   
                                                FROM    dbo.GEPolicys
                                                        INNER JOIN dbo.GEPolicyDefineCalcs ON GEPolicyDefineCalcs.FK_GEPolicyID = GEPolicys.GEPolicyID
                                                        INNER JOIN dbo.GEPolicyItems ON GEPolicyItems.FK_GEPolicyDefineCalcID = GEPolicyDefineCalcs.GEPolicyDefineCalcID
                                                        INNER JOIN dbo.GEPolicyItemMths ON GEPolicyItemMths.FK_GEPolicyItemID = GEPolicyItems.GEPolicyItemID
                                                        INNER JOIN dbo.GLObjects ON GLObjects.GLObjectID = GEPolicyItems.FK_GLObjectID
                                                        INNER JOIN dbo.ARCustomers ON ARCustomers.ARCustomerID = GLObjects.FK_ObjectRefID
                                                        left join ARSellers on ARSellers.ARSellerID = ARCustomers.FK_ARSellerID
                                                        INNER JOIN dbo.GEPolicyDefines ON GEPolicyDefines.GEPolicyDefineID = GEPolicyDefineCalcs.FK_GEPolicyDefineID
                                                        INNER JOIN dbo.GEPolicyDefineMths ON GEPolicyDefineMths.GEPolicyDefineMthID = GEPolicyItemMths.FK_GEPolicyDefineMthID
                                                        INNER JOIN dbo.GEPolicyDefineMthCfgs ON GEPolicyDefineMthCfgs.GEPolicyDefineMthCfgID = GEPolicyDefineMths.FK_GEPolicyDefineMthCfgID
                                                WHERE   GEPolicyItems.AAStatus = 'Alive'
                                                        AND GEPolicys.AAStatus = 'Alive'
                                                        AND GEPolicyDefineCalcs.AAStatus = 'Alive'
                                                        AND ARCustomers.AAStatus = 'Alive'
                                                        
                                                        AND GLObjects.AAStatus = 'Alive'
                                                        AND GEPolicys.AAStatus = 'Alive'
                                                        AND GEPolicyDefineMths.AAStatus = 'Alive'
                                                        AND GEPolicyDefineMthCfgs.AAStatus = 'Alive'

                                                        
                                                        {0}
                                                        {1}
                                                        {2}
                                                        {3}
                                                        

                                                  AND GEPolicyDefineMthCfgs.GEPolicyDefineMthCfgMapTypeCombo <> ''
												  AND GLObjects.GLObjectType = 'ARCustomers'
												  Group BY GEPolicyItems.FK_GLObjectID 
                                             
                                    
                                             ", strPolicyDefine, strFromTo, strTypeApprove, strSeller);

            DataSet ds = GetDataSet(strQuery);
            return ds;
        }

        public DataSet LayDanhSachThamSoTheoDoiTuongTinhToanKetQua(int iGEPolicyDefineCalcID, DateTime dtFrom, DateTime dtTo, int iGEPolicyDefineID, int iGLObjectID, String strPolicyDefineCfgItems_Condition)
        {

            String strTypeParam = String.Format(@" AND ( GEPolicyDefineMthCfgs.GEPolicyDefineMthCfgTypeCombo = 'QtyGS' OR GEPolicyDefineMthCfgs.GEPolicyDefineMthCfgTypeCombo = 'QtyGC' OR
                                                         GEPolicyDefineMthCfgs.GEPolicyDefineMthCfgTypeCombo = 'FAmtGS' OR GEPolicyDefineMthCfgs.GEPolicyDefineMthCfgTypeCombo = 'FAmtGC' OR
                                                         GEPolicyDefineMthCfgs.GEPolicyDefineMthCfgTypeCombo = 'PercentGS' OR GEPolicyDefineMthCfgs.GEPolicyDefineMthCfgTypeCombo = 'PercentGC' OR
                                                         GEPolicyDefineMthCfgs.GEPolicyDefineMthCfgTypeCombo = 'AmtGS' OR GEPolicyDefineMthCfgs.GEPolicyDefineMthCfgTypeCombo = 'AmtGC' OR
                                                         GEPolicyDefineMthCfgs.GEPolicyDefineMthCfgTypeCombo = 'OverHTGS' OR GEPolicyDefineMthCfgs.GEPolicyDefineMthCfgTypeCombo = 'OverHTGC' OR
                                                         GEPolicyDefineMthCfgs.GEPolicyDefineMthCfgTypeCombo = 'DescriptionRpt')
                                                ");


            String strQuery = String.Format(@" 
                                              SELECT  FK_GEPolicyDefineCfgItemID,
                                                      GEPolicyItemMths.GEPolicyItemMthFAmt AS ViewPolicyDefineStatisticWAmt,
                                                      GEPolicyDefineMthCfgs.GEPolicyDefineMthCfgTypeCombo AS ViewPolicyDefineStatisticTypeCombo
                                              FROM dbo.GEPolicys INNER JOIN dbo.GEPolicyDefineCalcs ON GEPolicyDefineCalcs.FK_GEPolicyID = GEPolicys.GEPolicyID
                                                               INNER JOIN dbo.GEPolicyItems ON GEPolicyItems.FK_GEPolicyDefineCalcID = GEPolicyDefineCalcs.GEPolicyDefineCalcID
				                                               INNER JOIN dbo.GEPolicyItemMths ON GEPolicyItemMths.FK_GEPolicyItemID = GEPolicyItems.GEPolicyItemID
				                                               INNER JOIN dbo.GEPolicyDefines ON GEPolicyDefines.GEPolicyDefineID = GEPolicyDefineCalcs.FK_GEPolicyDefineID
				                                               INNER JOIN dbo.GEPolicyDefineMths ON GEPolicyDefineMths.GEPolicyDefineMthID = GEPolicyItemMths.FK_GEPolicyDefineMthID
															   INNER JOIN dbo.GEPolicyDefineMthCfgs ON GEPolicyDefineMthCfgs.GEPolicyDefineMthCfgID = GEPolicyDefineMths.FK_GEPolicyDefineMthCfgID
                                              WHERE GEPolicyItems.AAStatus = 'Alive' AND GEPolicys.AAStatus = 'Alive' AND GEPolicyDefineCalcs.AAStatus = 'Alive' AND GEPolicyDefineMths.AAStatus = 'Alive' AND GEPolicyDefineMthCfgs.AAStatus = 'Alive'
                                                   
			   --AND ( GEPolicyDefineMthCfgs.GEPolicyDefineMthCfgTypeCombo = 'QtyGS' OR GEPolicyDefineMthCfgs.GEPolicyDefineMthCfgTypeCombo = 'QtyGC' OR
               --     GEPolicyDefineMthCfgs.GEPolicyDefineMthCfgTypeCombo = 'FAmtGS' OR GEPolicyDefineMthCfgs.GEPolicyDefineMthCfgTypeCombo = 'FAmtGC' OR
               --     GEPolicyDefineMthCfgs.GEPolicyDefineMthCfgTypeCombo = 'PercentGS' OR GEPolicyDefineMthCfgs.GEPolicyDefineMthCfgTypeCombo = 'PercentGC' OR
               --     GEPolicyDefineMthCfgs.GEPolicyDefineMthCfgTypeCombo = 'AmtGS' OR GEPolicyDefineMthCfgs.GEPolicyDefineMthCfgTypeCombo = 'AmtGC' OR
               --     GEPolicyDefineMthCfgs.GEPolicyDefineMthCfgTypeCombo = 'OverHTGS' OR GEPolicyDefineMthCfgs.GEPolicyDefineMthCfgTypeCombo = 'OverHTGC' )
                                                 
	                                              AND YEAR(GEPolicyFDate) = {0} AND MONTH(GEPolicyFDate) = {1}	                                              
                                                  AND GEPolicyItems.FK_GLObjectID = {2}
	                                              AND GEPolicyDefineCalcs.FK_GEPolicyDefineID = {3}
												  AND GEPolicyDefineCalcs.GEPolicyDefineCalcID = {4}
                                                  {5}
                                             ", dtFrom.Year, dtFrom.Month, iGLObjectID, iGEPolicyDefineID, iGEPolicyDefineCalcID, strPolicyDefineCfgItems_Condition);

            DataSet ds = GetDataSet(strQuery);
            return ds;
        }

        public void UpdateStatusForGEPolicyItemObject(int iGEPolicyID, int iGEPolicyDefineCalcID, int iGLObjectID, String strCondition_Approve, bool isUpdate)
        {
            String strStatus = "";
            if (isUpdate == true)
                strStatus = "Approved";
            else
                strStatus = "Postpone";

            String strQuery = String.Format(@"  UPDATE GEPolicyItems SET GEPolicyItems.GEPolicyItemObjectApproveCombo = '{0}'
                                                Where GEPolicyItems.GEPolicyItemID = (
                                                SELECT GEPolicyItems.GEPolicyItemID
                                                 FROM dbo.GEPolicys INNER JOIN dbo.GEPolicyDefineCalcs ON GEPolicyDefineCalcs.FK_GEPolicyID = GEPolicys.GEPolicyID
                                                                   INNER JOIN dbo.GEPolicyItems ON GEPolicyItems.FK_GEPolicyDefineCalcID = GEPolicyDefineCalcs.GEPolicyDefineCalcID
                                                WHERE GEPolicyItems.AAStatus = 'Alive' AND GEPolicys.AAStatus = 'Alive' AND GEPolicyDefineCalcs.AAStatus = 'Alive'
	                                                  AND GEPolicys.GEPolicyID = {1}
	                                                  AND GEPolicyItems.FK_GLObjectID = {2}
	                                                  AND GEPolicyItems.FK_GEPolicyDefineCalcID = {3}
                                                      {4}
                                                                                      )

                                             ", strStatus, iGEPolicyID, iGLObjectID, iGEPolicyDefineCalcID, strCondition_Approve);

            GetDataSet(strQuery);

        }

        public GEPolicyItemsInfo GetObjectByPolicyAndPolicyDefineAndGLObjectID(int iGEPolicyID, int iGEPolicyDefineCalcID, int iGLObjectID, String strCondition_Approve)
        {


            String strQuery = String.Format(@"  
                                                SELECT GEPolicyItems.*
                                                 FROM dbo.GEPolicys INNER JOIN dbo.GEPolicyDefineCalcs ON GEPolicyDefineCalcs.FK_GEPolicyID = GEPolicys.GEPolicyID
                                                                   INNER JOIN dbo.GEPolicyItems ON GEPolicyItems.FK_GEPolicyDefineCalcID = GEPolicyDefineCalcs.GEPolicyDefineCalcID
                                                WHERE GEPolicyItems.AAStatus = 'Alive' AND GEPolicys.AAStatus = 'Alive' AND GEPolicyDefineCalcs.AAStatus = 'Alive'
	                                                  AND GEPolicys.GEPolicyID = {0}
	                                                  AND GEPolicyItems.FK_GLObjectID = {1}
	                                                  AND GEPolicyItems.FK_GEPolicyDefineCalcID = {2}
                                                      {3}

                                             ", iGEPolicyID, iGLObjectID, iGEPolicyDefineCalcID, strCondition_Approve);

            DataSet ds = GetDataSet(strQuery);
            if (ds != null && ds.Tables.Count > 0 && ds.Tables[0].Rows.Count > 0)
            {
                return (GEPolicyItemsInfo)new GEPolicyItemsController().GetObjectFromDataRow(ds.Tables[0].Rows[0]);
            }

            return null;
        }

        public DataSet GetAllObjectByGEPolicyDefineCalcANDFrom_To(GEPolicysInfo objGEPolicysInfo, int iGEPolicyDefineCalcID)
        {
            String strQuery = String.Format(@" 
                                                SELECT GEPolicyItems.*
                                                FROM dbo.GEPolicys INNER JOIN dbo.GEPolicyDefineCalcs ON GEPolicyDefineCalcs.FK_GEPolicyID = GEPolicys.GEPolicyID
                                                                           INNER JOIN dbo.GEPolicyItems ON GEPolicyItems.FK_GEPolicyDefineID = GEPolicyDefineCalcs.FK_GEPolicyDefineID
                                                WHERE GEPolicyItems.AAStatus = 'Alive' AND GEPolicys.AAStatus = 'Alive' AND GEPolicyDefineCalcs.AAStatus = 'Alive'
	                                                  AND YEAR(GEPolicys.GEPolicyFDate) = {0} AND MONTH(GEPolicys.GEPolicyFDate) = {1}
	                                                  AND FK_GEPolicyDefineCalcID = {2}

                                             ", objGEPolicysInfo.GEPolicyFDate.Value.Year, objGEPolicysInfo.GEPolicyFDate.Value.Month, iGEPolicyDefineCalcID);

            DataSet ds = GetDataSet(strQuery);
            return ds;
        }

        public bool CheckQueryByPolicyDefine(int iGEPolicyDefineID, String strFromTo)
        {
            String strQuery = String.Format(@"  SELECT GEPolicyItems.*
                                                  FROM dbo.GEPolicys INNER JOIN dbo.GEPolicyDefineCalcs ON GEPolicyDefineCalcs.FK_GEPolicyID = GEPolicys.GEPolicyID
																   INNER JOIN GEPolicyItems on GEPolicyDefineCalcs.GEPolicyDefineCalcID = GEPolicyItems.FK_GEPolicyDefineCalcID
                                                WHERE GEPolicys.AAStatus = 'Alive' AND GEPolicyDefineCalcs.AAStatus ='Alive'AND GEPolicyItems.AAStatus ='Alive'
                                                      AND GEPolicyDefineCalcs.FK_GEPolicyDefineID = {0}
                                                      {1}
                                            ", iGEPolicyDefineID, strFromTo);

            DataSet ds = GetDataSet(strQuery);
            if (ds != null && ds.Tables.Count > 0 && ds.Tables[0].Rows.Count > 0)
                return true;

            return false;
        }

      
    }
    #endregion
}