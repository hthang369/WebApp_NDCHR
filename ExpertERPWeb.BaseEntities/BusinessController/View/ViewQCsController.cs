using System;
using System.Data;
using System.Text;
using System.Collections.Generic;
using ExpertWebLib;
namespace ExpertERP.BusinessEntities
{
	#region ViewQCs
	//-----------------------------------------------------------
	//Generated By: GMC Studio
	//Class:ViewQCsController
	//Created Date:25 Tháng Mười Hai 2013
	//-----------------------------------------------------------
	
	public class ViewQCsController:BaseBusinessController
	{
		public ViewQCsController()
		{
			dal= new DALBaseProvider("ViewQCs",typeof(ViewQCsInfo));
		}
        public DataSet GetAllQCViewByDate(DateTime dtFrom, DateTime dtTo)
        {
            string str = string.Format(@"SELECT *,
                                            ISNULL(ROUND(ViewQCValidQty * 100 / ViewQCQty, 2),0) AS ViewQCValidPct
                                            FROM (
                                              SELECT
                                              ProductionOrdr.FK_PPWOID,
                                              FK_PPProductionOrdrID,
                                              PrdQCItem.FK_PPPhaseCfgID,
                                              QCStepItem.PPQCStepItemName AS ViewQCName,
                                              PrdQCStepItem.PPPrdQCStepItemQty AS ViewQCQty,
                                              PrdQCStepItem.PPPrdQCStepItemValidQty AS ViewQCValidQty,
                                              PrdQCItem.FK_ICProductID,
                                              WO.PPWONo,
                                              ProductionOrdr.PPProductionOrdrNo,
                                              PhaseCfg.PPPhaseCfgNo,
                                              Product.ICProductNo
                                              FROM dbo.PPPrdQCStepItems PrdQCStepItem
                                              INNER JOIN dbo.PPPrdQCItems PrdQCItem ON PrdQCStepItem.FK_PPPrdQCItemID = PrdQCItem.PPPrdQCItemID
                                              INNER JOIN dbo.PPQCStepItems QCStepItem ON PrdQCStepItem.FK_PPQCStepItemID = QCStepItem.PPQCStepItemID
                                              INNER JOIN dbo.PPPrdQCs PrdQC ON PrdQCItem.FK_PPPrdQCID = PrdQC.PPPrdQCID
                                              INNER JOIN dbo.PPProductionOrdrs ProductionOrdr ON PrdQC.FK_PPProductionOrdrID = ProductionOrdr.PPProductionOrdrID
                                              INNER JOIN dbo.PPWOs WO ON ProductionOrdr.FK_PPWOID = WO.PPWOID
                                              INNER JOIN dbo.PPPhaseCfgs PhaseCfg ON PrdQCItem.FK_PPPhaseCfgID = PhaseCfg.PPPhaseCfgID
                                              INNER JOIN dbo.ICProducts Product ON PrdQCItem.FK_ICProductID = Product.ICProductID
                                              WHERE ProductionOrdr.AAStatus = 'Alive' AND PrdQC.AAStatus = 'Alive' 
                                              AND PrdQCItem.AAStatus = 'Alive' AND PrdQCStepItem.AAStatus = 'Alive' AND QCStepItem.AAStatus = 'Alive'
                                              AND CONVERT(VARCHAR, PPProductionOrdrDate, 112) >= '{0}'
                                              AND CONVERT(VARCHAR, PPProductionOrdrDate, 112) <= '{1}'
                                            ) TB", dtFrom.ToString("yyyyMMdd"), dtTo.ToString("yyyyMMdd"));
            return dal.GetDataSet(str);
        }

	}
	#endregion
}