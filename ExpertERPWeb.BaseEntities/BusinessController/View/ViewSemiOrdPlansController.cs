using System;
using System.Data;
using System.Text;
using System.Collections.Generic;
using ExpertWebLib;
namespace ExpertERP.BusinessEntities
{
	#region ViewSemiOrdPlans
	//-----------------------------------------------------------
	//Generated By: GMC Studio
	//Class:ViewSemiOrdPlansController
	//Created Date:24 Tháng Giêng 2013
	//-----------------------------------------------------------
	
	public class ViewSemiOrdPlansController:BaseBusinessController
	{
		public ViewSemiOrdPlansController()
		{
			dal= new DALBaseProvider("ViewSemiOrdPlans",typeof(ViewSemiOrdPlansInfo));
		}

        public DataSet GetData_TheoDoiKeHoachDatHang(int FromPeriord, int FromYear, int ToPeriod, int ToYear, int iShpPln)
        {
            DateTime dtFrom = new DateTime(FromYear, FromPeriord, 1);
            DateTime dtTo = new DateTime(ToYear, ToPeriod, DateTime.DaysInMonth(ToYear, ToPeriod));
            string strDate = DALUtil.GenerateBeetween("ARShpPlanDate", dtFrom, dtTo);
            string strQuery = String.Format(@"
SELECT 
	  ViewSemiOrdPlanQty,
      ViewSemiOrdPlanOnPOQty,
      ViewSemiOrdPlanOnPORQty,
      ViewSemiOrdPlanOnPORcpQty,
      FK_ARShpPlanID,
      FK_ARShpPlanItemID,
      FK_ICProductID,
      FK_APSupplierID,
      ICProductName,
      ICProductLength,
      ICProductWidth,
      ICProductHeght,
      ICProductCBM,
      ICProductUOM,
      ViewSemiOrdPlanDueDate,
      ViewSemiOrdPlanCompletePct,
      ViewSemiOrdPlanDueDateQty,
      ViewSemiOrdPlanType,
      ViewSemiOrdPlanMaterialCBM,
      ViewSemiOrdPlanMaterialCBMTotal,
      FK_ARSOID,
      Period,
      Year,
      FK_APSemiOrdPlanID,
      FK_APSemiDetailOrdPlanID
FROM 
	(
	SELECT 
	APSemiOrdPlans.APSemiOrdPlanQty AS ViewSemiOrdPlanQty,
	APSemiOrdPlans.APSemiOrdPlanOnPOQty AS ViewSemiOrdPlanOnPOQty,
	APSemiOrdPlans.APSemiOrdPlanOnPOQty-APSemiOrdPlans.APSemiOrdPlanOnPORcpQty AS ViewSemiOrdPlanOnPORQty,
	APSemiOrdPlans.APSemiOrdPlanOnPORcpQty AS ViewSemiOrdPlanOnPORcpQty,
	APSemiOrdPlans.FK_ARShpPlanID ,
	APSemiOrdPlans.FK_ARShpPlanItemID,
	APSemiOrdPlans.FK_ICProductID,
	APSemiOrdPlans.FK_APSupplierID,
	APSemiOrdPlans.ICProductName,
	APSemiOrdPlans.ICProductLength,
	APSemiOrdPlans.ICProductWidth,
	APSemiOrdPlans.ICProductHeght,
	APSemiOrdPlans.ICProductCBM,
	APSemiOrdPlans.ICProductUOM,
	APSemiOrdPlans.APSemiOrdPlanDueDate AS ViewSemiOrdPlanDueDate,
	APSemiOrdPlans.APSemiOrdPlanCompletePct AS ViewSemiOrdPlanCompletePct,
	APSemiOrdPlans.APSemiOrdPlanDueDateQty AS ViewSemiOrdPlanDueDateQty,
	APSemiOrdPlans.APSemiOrdPlanType AS ViewSemiOrdPlanType,
	APSemiOrdPlans.APSemiOrdPlanMaterialCBM AS ViewSemiOrdPlanMaterialCBM,
	APSemiOrdPlans.APSemiOrdPlanMaterialCBMTotal AS ViewSemiOrdPlanMaterialCBMTotal,
	0 AS FK_ARSOID,--APSemiOrdPlans.FK_ARSOID AS FK_ARSOID,
	MONTH(ARShpPlans.ARShpPlanDate) AS Period,
	YEAR(ARShpPlans.ARShpPlanDate) AS Year,
	APSemiOrdPlans.APSemiOrdPlanID AS FK_APSemiOrdPlanID,
	0 AS FK_APSemiDetailOrdPlanID
	FROM APSemiOrdPlans 
			INNER JOIN ARShpPlans  ON ARShpPlans.ARShpPlanID = APSemiOrdPlans.FK_ARShpPlanID
	
	WHERE	ARShpPlans.AAStatus='Alive'
			AND APSemiOrdPlans.AAStatus='Alive'
			AND {0}
			AND (APSemiOrdPlans.FK_ARShpPlanID={1} OR 0={1})
	
	
	Union All
	
	SELECT 
	APSemiDetailOrdPlans.APSemiDetailOrdPlanQty  AS ViewSemiOrdPlanQty,
	APSemiDetailOrdPlans.APSemiDetailOrdPlanOnPOQty AS ViewSemiOrdPlanOnPOQty,
	APSemiDetailOrdPlans.APSemiDetailOrdPlanOnPOQty-APSemiDetailOrdPlans.APSemiDetailOrdPlanOnPORcpQty AS ViewSemiOrdPlanOnPORQty,
	APSemiDetailOrdPlans.APSemiDetailOrdPlanOnPORcpQty AS ViewSemiOrdPlanOnPORcpQty,
	APSemiDetailOrdPlans.FK_ARShpPlanID ,
	APSemiDetailOrdPlans.FK_ARShpPlanItemID,
	APSemiDetailOrdPlans.FK_ICProductID,
	APSemiDetailOrdPlans.FK_APSupplierID,
	APSemiDetailOrdPlans.ICProductName,
	APSemiDetailOrdPlans.ICProductLength,
	APSemiDetailOrdPlans.ICProductWidth,
	APSemiDetailOrdPlans.ICProductHeght,
	APSemiDetailOrdPlans.ICProductCBM,
	APSemiDetailOrdPlans.ICProductUOM,
	APSemiDetailOrdPlans.APSemiDetailOrdPlanDueDate AS ViewSemiOrdPlanDueDate,
	APSemiDetailOrdPlans.APSemiDetailOrdPlanCompletePct AS ViewSemiOrdPlanCompletePct,
	APSemiDetailOrdPlans.APSemiDetailOrdPlanDueDateQty AS ViewSemiOrdPlanDueDateQty,
	'' AS ViewSemiOrdPlanType,
	0 AS ViewSemiOrdPlanMaterialCBM,
	0 AS ViewSemiOrdPlanMaterialCBMTotal,
	0 AS FK_ARSOID,--APSemiDetailOrdPlans.FK_ARSOID AS FK_ARSOID,
	MONTH(ARShpPlans.ARShpPlanDate) AS Period,
	YEAR(ARShpPlans.ARShpPlanDate) AS Year,
	0 AS FK_APSemiOrdPlanID,
	APSemiDetailOrdPlans.APSemiDetailOrdPlanID AS FK_APSemiDetailOrdPlanID

	FROM APSemiDetailOrdPlans
			INNER JOIN ARShpPlans  ON ARShpPlans.ARShpPlanID = APSemiDetailOrdPlans.FK_ARShpPlanID
	
	WHERE	ARShpPlans.AAStatus='Alive'
			AND APSemiDetailOrdPlans.AAStatus='Alive'
			AND {0}
			AND (APSemiDetailOrdPlans.FK_ARShpPlanID={1} OR 0={1})
	
	) AS TB
	
ORDER BY TB.FK_ARShpPlanID", strDate, iShpPln);
            return GetDataSet(strQuery);
                
        }
    }
	#endregion
}