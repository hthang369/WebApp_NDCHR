using System;
using System.Data;
using System.Text;
using System.Collections.Generic;
using ExpertWebLib;
namespace ExpertERP.BusinessEntities
{
	#region ViewProductionOrdrs
	//-----------------------------------------------------------
	//Generated By: GMC Studio
	//Class:ViewProductionOrdrsController
	//Created Date:27 May 2013
	//-----------------------------------------------------------
	
	public class ViewProductionOrdrsController:BaseBusinessController
	{
		public ViewProductionOrdrsController()
		{
			dal= new DALBaseProvider("ViewProductionOrdrs",typeof(ViewProductionOrdrsInfo));
		}
        public DataSet GetAllDataByCondition(int pPWOID, int pPWorkCenterID, int pPPhaseCfgID)
        {
            string strQuery = string.Format(@"      IF OBJECT_ID('tempdb..#WO') IS NOT NULL
                                                        DROP TABLE #WO;
                                                    IF OBJECT_ID('tempdb..#Cal') IS NOT NULL
                                                        DROP TABLE #Cal;
                                                    IF OBJECT_ID('tempdb..#Ordr') IS NOT NULL
                                                        DROP TABLE #Ordr;
                                                    --------------------------
                                                    SELECT  PPWOEstFGItems.FK_ARSOID ,
                                                            PPWOEstFGItems.FK_ARSOItemID ,
                                                            PPWOEstFGItems.FK_ARShpPlanItemID ,
                                                            PPWOEstFGItems.FK_PPWOID ,
                                                            PPWOEstFGItems.FK_PPRoutingID ,
                                                            PPWOEstFGItems.FK_PPPhaseCfgID ,
                                                            PPWOEstFGItems.FK_PPWorkCenterID ,
                                                            PPWOEstFGItems.FK_ICProductID ,
                                                            PPWOEstFGItems.FK_ICUOMID ,
		                                                    PPWOEstFGItems.PPWOEstFGItemLotNo AS ViewProductionOrdrLotNo ,
                                                            PPWOEstFGItems.PPWOEstFGItemQty AS ViewProductionOrdrWOQty ,
                                                            PPWOEstFGItems.PPWOEstFGItemEndDate AS ViewProductionOrdrEstEndDate
                                                    INTO    #WO
                                                    FROM    dbo.PPWOEstFGItems
                                                            INNER JOIN dbo.PPWOs ON PPWOs.PPWOID = PPWOEstFGItems.FK_PPWOID
                                                                                    AND PPWOs.AAStatus = 'Alive'
                                                    WHERE   ( PPWOEstFGItems.FK_PPWOID = {0}
                                                                OR 0 = {0}
                                                            )
                                                            AND ( PPWOEstFGItems.FK_PPPhaseCfgID = {1}
                                                                    OR 0 = {1}
                                                                )
                                                            AND ( PPWOEstFGItems.FK_PPWorkCenterID = {2}
                                                                    OR 0 = {2}
                                                                );
                                                    --------------------------
                                                    SELECT  PPProductionCalendars.FK_ARSOID ,
                                                            PPProductionCalendars.FK_ARSOItemID ,
                                                            PPProductionCalendars.FK_ARShpPlanItemID ,
                                                            PPProductionCalendars.FK_PPWOID ,
                                                            PPProductionCalendars.FK_PPRoutingID ,
                                                            PPProductionCalendars.FK_PPPhaseCfgID ,
                                                            PPProductionCalendars.FK_PPWorkCenterID ,
                                                            PPProductionCalendars.FK_PPResourceID ,
                                                            PPProductionCalendars.FK_ICProductID ,
                                                            PPProductionCalendars.FK_ICUOMID ,
                                                            PPProductionCalendars.PPProductionCalendarLotNo AS ViewProductionOrdrLotNo ,
                                                            SUM(PPProductionCalendars.PPProductionCalendarQty) AS ViewProductionOrdrCalendarQty
                                                    INTO    #Cal
                                                    FROM    dbo.PPProductionCalendars
                                                    WHERE   PPProductionCalendars.AAStatus = 'Alive'
                                                            AND ( PPProductionCalendars.FK_PPWOID = {0}
                                                                    OR 0 = {0}
                                                                )
                                                            AND ( PPProductionCalendars.FK_PPPhaseCfgID = {1}
                                                                    OR 0 = {1}
                                                                )
                                                            AND ( PPProductionCalendars.FK_PPWorkCenterID = {2}
                                                                    OR 0 = {2}
                                                                )
                                                    GROUP BY PPProductionCalendars.FK_ARSOID ,
                                                            PPProductionCalendars.FK_ARSOItemID ,
                                                            PPProductionCalendars.FK_ARShpPlanItemID ,
                                                            PPProductionCalendars.FK_PPWOID ,
                                                            PPProductionCalendars.FK_PPRoutingID ,
                                                            PPProductionCalendars.FK_PPPhaseCfgID ,
                                                            PPProductionCalendars.FK_PPWorkCenterID ,
                                                            PPProductionCalendars.FK_PPResourceID ,
                                                            PPProductionCalendars.FK_ICProductID ,
                                                            PPProductionCalendars.FK_ICUOMID ,
                                                            PPProductionCalendars.PPProductionCalendarLotNo;
                                                    --------------------------
                                                    SELECT  PPProductionOrdrEstFGs.FK_ARSOID ,
                                                            PPProductionOrdrEstFGs.FK_ARSOItemID ,
                                                            PPProductionOrdrEstFGs.FK_ARShpPlanItemID ,
                                                            PPProductionOrdrEstFGs.FK_PPWOID ,
                                                            PPProductionOrdrEstFGs.FK_PPRoutingID ,
                                                            PPProductionOrdrEstFGs.FK_PPPhaseCfgID ,
                                                            PPProductionOrdrEstFGs.FK_PPWorkCenterID ,
                                                            PPProductionOrdrEstFGs.FK_PPResourceID ,
                                                            PPProductionOrdrEstFGs.FK_ICProductID ,
                                                            PPProductionOrdrEstFGs.FK_ICUOMID ,
                                                            PPProductionOrdrEstFGs.PPProductionOrdrEstFGLotNo AS ViewProductionOrdrLotNo ,
                                                            SUM(PPProductionOrdrEstFGQty) AS ViewProductionOrdrQty
                                                    INTO    #Ordr
                                                    FROM    dbo.PPProductionOrdrEstFGs
                                                            INNER JOIN dbo.PPProductionOrdrs ON PPProductionOrdrs.PPProductionOrdrID = PPProductionOrdrEstFGs.FK_PPProductionOrdrID
                                                                                                AND PPProductionOrdrs.AAStatus = 'Alive'
                                                    WHERE   PPProductionOrdrEstFGs.AAStatus = 'Alive'
                                                            AND ( PPProductionOrdrEstFGs.FK_PPWOID = {0}
                                                                    OR 0 = {0}
                                                                )
                                                            AND ( PPProductionOrdrEstFGs.FK_PPPhaseCfgID = {1}
                                                                    OR 0 = {1}
                                                                )
                                                            AND ( PPProductionOrdrEstFGs.FK_PPWorkCenterID = {2}
                                                                    OR 0 = {2}
                                                                )
                                                    GROUP BY PPProductionOrdrEstFGs.FK_ARSOID ,
                                                            PPProductionOrdrEstFGs.FK_ARSOItemID ,
                                                            PPProductionOrdrEstFGs.FK_ARShpPlanItemID ,
                                                            PPProductionOrdrEstFGs.FK_PPWOID ,
                                                            PPProductionOrdrEstFGs.FK_PPRoutingID ,
                                                            PPProductionOrdrEstFGs.FK_PPPhaseCfgID ,
                                                            PPProductionOrdrEstFGs.FK_PPWorkCenterID ,
                                                            PPProductionOrdrEstFGs.FK_PPResourceID ,
                                                            PPProductionOrdrEstFGs.FK_ICProductID ,
                                                            PPProductionOrdrEstFGs.FK_ICUOMID ,
                                                            PPProductionOrdrEstFGs.PPProductionOrdrEstFGLotNo;
                                                    --------------------------
                                                    SELECT  
                                                            #WO.FK_ARSOID ,
                                                            #WO.FK_ARSOItemID ,
                                                            #WO.FK_ARShpPlanItemID ,
                                                            #WO.FK_PPWOID ,
                                                            #WO.FK_PPRoutingID ,
                                                            #WO.FK_PPPhaseCfgID ,
                                                            #WO.FK_PPWorkCenterID ,
                                                            #WO.FK_ICProductID ,
                                                            #WO.FK_ICUOMID ,
                                                            #WO.ViewProductionOrdrWOQty ,
                                                            #WO.ViewProductionOrdrEstEndDate ,
                                                            ISNULL(#Cal.ViewProductionOrdrLotNo,'') ViewProductionOrdrLotNo,
                                                            ISNULL(#Cal.ViewProductionOrdrCalendarQty,0) ViewProductionOrdrCalendarQty,
                                                            ISNULL(#Cal.ViewProductionOrdrCalendarQty,0)
                                                            - ISNULL(#Ordr.ViewProductionOrdrQty, 0) AS ViewProductionOrdrRQty
                                                    FROM    #WO
                                                            LEFT JOIN #Cal ON #Cal.FK_ARSOID = #WO.FK_ARSOID
                                                                                AND #Cal.FK_ARSOItemID = #WO.FK_ARSOItemID
                                                                                AND #Cal.FK_ARShpPlanItemID = #WO.FK_ARShpPlanItemID
                                                                                AND #Cal.FK_PPWOID = #WO.FK_PPWOID
                                                                                AND #Cal.FK_PPRoutingID = #WO.FK_PPRoutingID
                                                                                AND #Cal.FK_PPPhaseCfgID = #WO.FK_PPPhaseCfgID
                                                                                AND #Cal.FK_PPWorkCenterID = #WO.FK_PPWorkCenterID
                                                                                AND #Cal.FK_ICProductID = #WO.FK_ICProductID
                                                                                AND #Cal.FK_ICUOMID = #WO.FK_ICUOMID
							                                                    AND #Cal.ViewProductionOrdrLotNo = #WO.ViewProductionOrdrLotNo
                                                            LEFT JOIN #Ordr ON #Ordr.FK_ARSOID = #Cal.FK_ARSOID
                                                                                AND #Ordr.FK_ARSOItemID = #Cal.FK_ARSOItemID
                                                                                AND #Ordr.FK_ARShpPlanItemID = #Cal.FK_ARShpPlanItemID
                                                                                AND #Ordr.FK_PPWOID = #Cal.FK_PPWOID
                                                                                AND #Ordr.FK_PPRoutingID = #Cal.FK_PPRoutingID
                                                                                AND #Ordr.FK_PPPhaseCfgID = #Cal.FK_PPPhaseCfgID
                                                                                AND #Ordr.FK_PPWorkCenterID = #Cal.FK_PPWorkCenterID
                                                                                AND #Ordr.FK_PPResourceID = #Cal.FK_PPResourceID
                                                                                AND #Cal.FK_ICProductID = #Cal.FK_ICProductID
                                                                                AND #Ordr.FK_ICUOMID = #Cal.FK_ICUOMID
                                                                                AND #Ordr.ViewProductionOrdrLotNo = #Cal.ViewProductionOrdrLotNo
                                                    ORDER BY #WO.ViewProductionOrdrEstEndDate
                                                    -----------------
                                                    IF OBJECT_ID('tempdb..#WO') IS NOT NULL
                                                        DROP TABLE #WO;
                                                    IF OBJECT_ID('tempdb..#Cal') IS NOT NULL
                                                        DROP TABLE #Cal;
                                                    IF OBJECT_ID('tempdb..#Ordr') IS NOT NULL
                                                        DROP TABLE #Ordr;", pPWOID, pPPhaseCfgID, pPWorkCenterID);

            return dal.GetDataSet(strQuery);
        }
    }
	#endregion
}