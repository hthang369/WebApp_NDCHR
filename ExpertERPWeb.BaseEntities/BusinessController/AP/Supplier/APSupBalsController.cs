using System;
using System.Data;
using System.Text;
using System.Collections.Generic;
using ExpertWebLib;
namespace ExpertERP.BusinessEntities
{
	#region APSupBals
	//-----------------------------------------------------------
	//Generated By: GMC Studio
	//Class:APSupBalsController
	//Created Date:Tuesday, July 05, 2011
	//-----------------------------------------------------------
	
	public class APSupBalsController:BaseBusinessController
	{
		public APSupBalsController()
		{
			dal= new DALBaseProvider("APSupBals",typeof(APSupBalsInfo));
		}

        public APSupBalsInfo GetCustBalace_byYearMonthAndFK_SupplierID(int year, int month, int FK_APSupplierID)
        {
            return (APSupBalsInfo)dal.GetDataObject("ARSupplierBalance_SelectByYearMonthAndFK_SupplierID", year, month, FK_APSupplierID);
        }

        public APSupBalsInfo GetSupBalInPeriodBySupplier(int iPeriod, int iYear, int iSupplierID)
        {
            String strQuery = String.Format(@"SELECT * FROM  APSupBals Where AAStatus = 'Alive' And APSupBalPeriod = {0} AND APSupBalYear = {1} And FK_APSupplierID = {2}", iPeriod, iYear, iSupplierID);
            DataSet ds = dal.GetDataSet(strQuery);

            if (ds != null && ds.Tables.Count > 0 && ds.Tables[0].Rows.Count > 0 && ds.Tables[0].Rows[0][0] != DBNull.Value)
                return (APSupBalsInfo)dal.GetObjectFromDataRow(ds.Tables[0].Rows[0]);

            return null;
        }

        public APSupBalsInfo GetSupBalBegin(int iSupplierID)
        {
            String strQuery = String.Format(@"SELECT TOP 1 * FROM dbo.APSupBals WHERE AAStatus='Alive' AND FK_APSupplierID={0} 
                                                    ORDER BY APSupBalYear, APSupBalPeriod", iSupplierID);
            DataSet ds = dal.GetDataSet(strQuery);

            if (ds != null && ds.Tables.Count > 0 && ds.Tables[0].Rows.Count > 0)
                return (APSupBalsInfo)dal.GetObjectFromDataRow(ds.Tables[0].Rows[0]);

            return null;
        }

        public APSupBalsInfo GetSupBalEnd(int iSupplierID)
        {
            String strQuery = String.Format(@"SELECT TOP 1 * FROM dbo.APSupBals WHERE AAStatus='Alive' AND FK_APSupplierID={0} 
                                                    ORDER BY APSupBalYear Desc, APSupBalPeriod Desc", iSupplierID);
            DataSet ds = dal.GetDataSet(strQuery);

            if (ds != null && ds.Tables.Count > 0 && ds.Tables[0].Rows.Count > 0)
                return (APSupBalsInfo)dal.GetObjectFromDataRow(ds.Tables[0].Rows[0]);

            return null;
        }
        public void DeleteSupplierBalanceBeforeMonthAndYear(int iSupplierID, int iPeriod, int iYear)
        {
            String strQuery = String.Format(@"UPDATE dbo.APSupBals SET AAStatus='Delete' WHERE AAStatus='Alive' AND FK_APSupplierID={0} AND APSupBalPeriod< {1} AND APSupBalYear<={2}"
                                                    , iSupplierID, iPeriod, iYear);
            dal.GetDataSet(strQuery);
        }

        #region Thung - lay cong no nha cung cap theo thang va nam  - 6/4/2012

        public APSupBalsInfo GetSupBalByPeriodAndYear(int iSupplierID,int iPeriod,int iYear)
        {
            String strQuery = String.Format(@"SELECT TOP 1 * FROM dbo.APSupBals WHERE AAStatus='Alive' AND FK_APSupplierID={0} AND APSupBalPeriod={1}
                                                  AND APSupBalYear={2}", iSupplierID,iPeriod,iYear);
            DataSet ds = dal.GetDataSet(strQuery);

            if (ds != null && ds.Tables.Count > 0 && ds.Tables[0].Rows.Count > 0)
                return (APSupBalsInfo)dal.GetObjectFromDataRow(ds.Tables[0].Rows[0]);

            return null;
        }

        #endregion
    }
	#endregion
}