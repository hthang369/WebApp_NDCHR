using System;
using System.Data;
using System.Text;
using System.Collections.Generic;
using ExpertWebLib;
namespace ExpertERP.BusinessEntities
{
	#region FAAssets
	//-----------------------------------------------------------
	//Generated By: GMC Studio
	//Class:FAAssetsController
	//Created Date:Saturday, July 11, 2009
	//-----------------------------------------------------------
	
	public class FAAssetsController:BaseBusinessController
	{
        private readonly string spGetAssetsByAssetStatus = "FAAssets_SelectByAssetStatus";

		public FAAssetsController()
		{
			dal= new DALBaseProvider("FAAssets",typeof(FAAssetsInfo));
		}

        public DataSet GetAssetsByAssetStatus(String strAssetStatus)
        {
            return dal.GetDataSet(spGetAssetsByAssetStatus, strAssetStatus);
        }

        public DataSet GetAllAssetForDepr()
        {
            String StrQuery = String.Format("Select * from FAAssets WHERE AAStatus = 'Alive' AND FAAssetNetbookAmt > 0 AND (FAAssetStatus = 'InUse' OR FAAssetStatus = 'Broken')");
            return dal.GetDataSet(StrQuery);
        }
        public DataSet GetAllAssetForDeprByStatusInUse()
        {
            String StrQuery = String.Format("SELECT * FROM FAAssets WHERE AAStatus = 'Alive' AND FAAssetNetbookAmt > 0 AND FAAssetStatus = 'InUse'");
            return dal.GetDataSet(StrQuery);
        }
        public DataSet GetAllAssetNotDecr(int iYear, int iMonth)
        {
            String StrQuery = "";
            if (iMonth > 0)
            {
                StrQuery = String.Format(@"SELECT  a.*
                                                FROM    FAAssets a
                                                        LEFT JOIN ( SELECT  FK_FAAssetID
                                                                    FROM    FAAssetDecreaseItems b
                                                                            INNER JOIN FAAssetDecreases c ON c.AAStatus = 'Alive'
                                                                                                             AND b.FK_FAAssetDecreaseID = c.FAAssetDecreaseID
                                                                                                             AND ( YEAR(FAAssetDecreaseDate)
                                                                                                              * 12
                                                                                                              + MONTH(FAAssetDecreaseDate) < {0}
                                                                                                              * 12 + {1} )
                                                                                                             AND ( b.FAAssetDecreaseItemTypeCombo = 'BaoMat'
                                                                                                                      OR b.FAAssetDecreaseItemTypeCombo = 'ThanhLy'
                                                                                                                      OR b.FAAssetDecreaseItemTypeCombo = 'BaoHong'
                                                                                                                      )
                                                                    WHERE   b.AAStatus = 'Alive'
                                                                  ) AS d ON a.FAAssetID = d.FK_FAAssetID
                                                WHERE   a.AAStatus = 'Alive'
                                                        AND ( YEAR(a.FAAssetUserDate) * 12 + MONTH(a.FAAssetUserDate) <= {0}
                                                              * 12 + {1} )
                                                        AND d.FK_FAAssetID IS NULL", iYear, iMonth);
            }
            else
            {
                StrQuery = String.Format(@"SELECT  a.*
                                                FROM    FAAssets a
                                                        LEFT JOIN ( SELECT  FK_FAAssetID
                                                                    FROM    FAAssetDecreaseItems b
                                                                            INNER JOIN FAAssetDecreases c ON c.AAStatus = 'Alive'
                                                                                                             AND b.FK_FAAssetDecreaseID = c.FAAssetDecreaseID
                                                                                                             AND YEAR(FAAssetDecreaseDate)< {0} 
                                                                                                             AND ( b.FAAssetDecreaseItemTypeCombo = 'BaoMat'
                                                                                                                      OR b.FAAssetDecreaseItemTypeCombo = 'ThanhLy'
                                                                                                                      OR b.FAAssetDecreaseItemTypeCombo = 'BaoHong'
                                                                                                                      )
                                                                    WHERE   b.AAStatus = 'Alive'
                                                                  ) AS d ON a.FAAssetID = d.FK_FAAssetID
                                                WHERE   a.AAStatus = 'Alive'
                                                        AND  YEAR(a.FAAssetUserDate)<= {0}
                                                        AND d.FK_FAAssetID IS NULL", iYear);
            }
            return dal.GetDataSet(StrQuery);
        }
	}
	#endregion
}