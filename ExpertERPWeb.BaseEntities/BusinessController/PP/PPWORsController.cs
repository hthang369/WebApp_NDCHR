 using System;
using System.Data;
using System.Text;
using System.Collections.Generic;
using ExpertWebLib;
namespace ExpertERP.BusinessEntities
{
	#region PPWORs
	//-----------------------------------------------------------
	//Generated By: SQLDBTools.NET - LINHCLH (v2.0.8)
	//Class: PPWORsController
	//Created Date: Wednesday, 28 Jun 2017
	//-----------------------------------------------------------
	
	public class PPWORsController : BaseBusinessController
	{
		public PPWORsController()
		{
			dal = new DALBaseProvider("PPWORs",typeof(PPWORsInfo));
		}
        public DataSet GetRQtyWORItemsByWORID(int iWORID)
        {
            string strQuery = string.Format(@"SELECT PPWORItems.PPWORItemID,
                                                    PPWORItems.PPWORItemQty - ISNULL(WO.PPWOItemQty,0) AS PPWORItemQty
                                            FROM dbo.PPWORs
                                                INNER JOIN dbo.PPWORItems
                                                    ON PPWORItems.FK_PPWORID = PPWORs.PPWORID
                                                        AND PPWORItems.AAStatus = 'Alive'
                                                LEFT JOIN
                                                    (
                                                        SELECT PPWOPItems.FK_PPWORItemID AS FK_PPWORItemID,
                                                            SUM(PPWOPItems.PPWOPItemQty) AS PPWOItemQty
                                                        FROM dbo.PPWOs
                                                            INNER JOIN dbo.PPWOPItems
                                                                ON PPWOPItems.FK_PPWOID = PPWOs.PPWOID
                                                        WHERE PPWOs.AAStatus = 'Alive'
				                                            AND PPWOPItems.FK_PPWORID = {0}
                                                        GROUP BY PPWOPItems.FK_PPWORItemID
                                                    )WO ON WO.FK_PPWORItemID = PPWORItems.PPWORItemID
                                            WHERE 
                                                    PPWORs.AAStatus = 'Alive'                                                        
		                                            AND PPWORItems.PPWORItemQty > ISNULL(WO.PPWOItemQty,0) 
		                                            AND dbo.PPWORs.PPWORID = {0};
                                                ", iWORID);
            return dal.GetDataSet(strQuery);
        }
    }
	#endregion
}