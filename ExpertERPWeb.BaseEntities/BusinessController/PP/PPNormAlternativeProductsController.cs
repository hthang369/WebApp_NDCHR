using System;
using System.Data;
using System.Text;
using System.Collections.Generic;
using ExpertWebLib;


namespace ExpertERP.BusinessEntities
{
	#region PPNormAlternativeProducts
	//-----------------------------------------------------------
	//Generated By: SQLDBTools.NET - LINHCLH (v1.0.22)
	//Class: PPNormAlternativeProductsController
	//Created Date: Tuesday, 09 May 2017
	//-----------------------------------------------------------
	
	public class PPNormAlternativeProductsController : BaseBusinessController
	{
		public PPNormAlternativeProductsController()
		{
			dal = new DALBaseProvider("PPNormAlternativeProducts",typeof(PPNormAlternativeProductsInfo));
		}
        public DataSet GetAllAlternativeMaterial(params string[] lstProductID)
        {
            string strQuery = string.Format(@"
    select	cast(0 as bit) as AASelected,a.FK_ICProductID as FK_ICAlternativeProductID,
            isnull(round(PPNormAlternativeQty / a.PPNormRMQty, 6), 0) PPNormAlternativeProductFactor,
		    b.FK_ICProductID,
            isnull((select SUM(Qty) from fnc_GetTotalInvQtyByProductAndStock(b.FK_ICProductID,c.FK_ICStockID,getdate())), 0) PPNormAlternativeProductStkQty
    from PPNormRMs a
    left join PPNormAlternatives b on a.PPNormRMID = b.FK_PPNormRMID and b.AAStatus = 'Alive'
    left join ICProducts c on b.FK_ICProductID = c.ICProductID and c.AAStatus = 'Alive'
    where a.AAStatus = 'Alive' and a.FK_ICProductID in ({0})", string.Join(",", lstProductID));
            return GetDataSet(strQuery);
        }
        public DataSet GetAllObjectAlternativeMaterial(int iProductID)
        {
            string strQuery = string.Format(@"
    select	a.FK_ICProductID as FK_ICAlternativeProductID,
            isnull(round(PPNormAlternativeQty / a.PPNormRMQty, 6), 0) PPNormAlternativeProductFactor,
		    PPNormRMQty,b.FK_ICProductID,
		    isnull(PPNormRMQty * round(PPNormAlternativeQty / a.PPNormRMQty, 6), 0) PPNormAlternativeProductQty,
            isnull((select Qty from fnc_GetTotalInvQtyByProductAndStock(b.FK_ICProductID,c.FK_ICStockID,getdate())), 0) PPNormAlternativeProductStkQty
    from PPNormRMs a
    left join PPNormAlternatives b on a.PPNormRMID = b.FK_PPNormRMID and b.AAStatus = 'Alive'
    left join ICProducts c on b.FK_ICProductID = c.ICProductID and c.AAStatus = 'Alive'
    where a.AAStatus = 'Alive' and a.FK_ICProductID = {0}", iProductID);
            return GetDataSet(strQuery);
        }
    }
	#endregion
}