using System;
using System.Data;
using System.Text;
using System.Collections.Generic;
using ExpertWebLib;
namespace ExpertERP.BusinessEntities
{
	#region PPRoutingOperationMaterialStocks
	//-----------------------------------------------------------
	//Generated By: GMC Studio
	//Class:PPRoutingOperationMaterialStocksController
	//Created Date:01 Tháng Bảy 2013
	//-----------------------------------------------------------
	
	public class PPRoutingOperationMaterialStocksController:BaseBusinessController
	{
		public PPRoutingOperationMaterialStocksController()
		{
			dal= new DALBaseProvider("PPRoutingOperationMaterialStocks",typeof(PPRoutingOperationMaterialStocksInfo));
		}

        #region Lấy RoutingOperationMaterialStock đầu tiên tìm thấy theo công đoạn --Vinh -- 19/08/2013

        public PPRoutingOperationMaterialStocksInfo GetFirstObjByPhaseCfg(int iPhaseCfgID, int iProductIDWO, int iProductID)
        {
            String str = String.Format(@"   SELECT TOP 1 * FROM dbo.PPRoutingOperationMaterialStocks
                                            WHERE AAStatus = 'Alive'
                                            AND FK_PPRoutingOperationID IN (
									                                            SELECT PPRoutingOperationID FROM dbo.PPRoutingOperations
									                                            WHERE AAStatus = 'Alive'
									                                            AND FK_PPRoutingID IN (SELECT PPRoutingID FROM dbo.PPRoutings WHERE AAStatus = 'Alive')
									                                            AND FK_PPPhaseCfgID = {0}
                                                                                AND FK_PPRoutingID IN (SELECT FK_PPRoutingID FROM dbo.PPRoutingItems WHERE AAStatus = 'Alive' AND FK_ICProductID = {1})
								                                            )
                                            AND 
                                            (
                                                (
                                                    FK_ICProductGroupID = 0
                                                    OR
	                                                FK_ICProductGroupID IN (
								                                                SELECT FK_ICProductGroupID FROM dbo.ICProducts WHERE AAStatus = 'Alive' AND ICProductID = {2}
							                                                )
                                                )
	                                            AND
                                                (
                                                    FK_ICProductTypeID = 0 
                                                    OR
	                                                FK_ICProductTypeID IN (
								                                                SELECT FK_ICProductTypeID FROM dbo.ICProducts WHERE AAStatus = 'Alive' AND ICProductID = {2}
							                                                )
                                                )
                                            )", iPhaseCfgID, iProductIDWO, iProductID);
            DataSet ds = dal.GetDataSet(str);
            if (ds != null && ds.Tables.Count > 0 && ds.Tables[0].Rows.Count > 0)
            {
                return (PPRoutingOperationMaterialStocksInfo)dal.GetObjectFromDataRow(ds.Tables[0].Rows[0]);
            }
            return null;
        }

        #endregion
	}
	#endregion
}