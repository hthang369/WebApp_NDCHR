using System;
using System.Data;
using System.Text;
using System.Collections.Generic;
using ExpertWebLib;
namespace ExpertERP.BusinessEntities
{
	#region ARSaleOpps
	//-----------------------------------------------------------
	//Generated By: GMC Studio
	//Class:ARSaleOppsController
	//Created Date:Tuesday, May 22, 2012
	//-----------------------------------------------------------
	
	public class ARSaleOppsController:BaseBusinessController
	{
		public ARSaleOppsController()
		{
			dal= new DALBaseProvider("ARSaleOpps",typeof(ARSaleOppsInfo));
		}

        public int GetCountOfSaleOppByTypeFromDateToDate(String Type, DateTime fromdate, DateTime todate)
        {
            String query = String.Format("Select count(*) From ARSaleOpps Where AAStatus = 'Alive' And ARSaleOppStatusCombo = '{0}' And (CONVERT(VARCHAR(20), [ARSaleOppStartDate], 112) Between CONVERT(VARCHAR(20),'{1}', 112) And CONVERT(VARCHAR(20),'{2}', 112) )", Type, String.Format("{0:yyyyMMdd}", fromdate), String.Format("{0:yyyyMMdd}", todate));
            DataSet ds = dal.GetDataSet(query);
            if (ds != null && ds.Tables.Count > 0 && ds.Tables[0].Rows.Count > 0 && ds.Tables[0].Rows[0][0] != DBNull.Value)
                return (int)ds.Tables[0].Rows[0][0];

            return 0;
        }
        public DataSet GetAllDataByTypeInRange(String Type, DateTime fromdate, DateTime todate)
        {
            String query = String.Format("Select * From ARSaleOpps Where AAStatus = 'Alive' And ARSaleOppStatusCombo = '{0}' And (CONVERT(VARCHAR(20), [ARSaleOppStartDate], 112) Between CONVERT(VARCHAR(20),'{1}', 112) And CONVERT(VARCHAR(20),'{2}', 112) )", Type, String.Format("{0:yyyyMMdd}", fromdate), String.Format("{0:yyyyMMdd}", todate));
            return dal.GetDataSet(query);
        }

        public int GetCountOfSaleOppByTypeCustomerFromDateToDate(int iCustomerID, String Type, DateTime fromdate, DateTime todate)
        {
            String query = String.Format(@"Select count(*) From ARSaleOpps Where AAStatus = 'Alive' And ARSaleOppStatusCombo = '{0}' AND (FK_ARCustomerID={3} or 0={3})
                                                            And (CONVERT(VARCHAR(20), [ARSaleOppStartDate], 112) 
                                                            Between CONVERT(VARCHAR(20),'{1}', 112) And CONVERT(VARCHAR(20),'{2}', 112) )"
                                       , Type, String.Format("{0:yyyyMMdd}", fromdate), String.Format("{0:yyyyMMdd}", todate), iCustomerID);
            DataSet ds = dal.GetDataSet(query);
            if (ds != null && ds.Tables.Count > 0 && ds.Tables[0].Rows.Count > 0 && ds.Tables[0].Rows[0][0] != DBNull.Value)
                return Convert.ToInt32(ds.Tables[0].Rows[0][0]);

            return 0;
        }
        public DataSet GetAllDataByTypeCustomerInRange(int iCustomerID, String Type, DateTime fromdate, DateTime todate)
        {
            String query = String.Format(@"Select * From ARSaleOpps Where AAStatus = 'Alive' And ARSaleOppStatusCombo = '{0}' AND (FK_ARCustomerID={3} or 0={3})
                                                            And (CONVERT(VARCHAR(20), [ARSaleOppStartDate], 112) 
                                                            Between CONVERT(VARCHAR(20),'{1}', 112) And CONVERT(VARCHAR(20),'{2}', 112) )"
                                       , Type, String.Format("{0:yyyyMMdd}", fromdate), String.Format("{0:yyyyMMdd}", todate), iCustomerID);
            return dal.GetDataSet(query);
        }

        public int GetCountOfSaleOppByTypeSellerFromDateToDate(int iARSellerID, String Type, DateTime fromdate, DateTime todate)
        {
            String query = String.Format(@"Select count(*) From ARSaleOpps Where AAStatus = 'Alive' And ARSaleOppStatusCombo = '{0}'
                                                            And (CONVERT(VARCHAR(20), [ARSaleOppStartDate], 112) 
                                                            Between CONVERT(VARCHAR(20),'{1}', 112) And CONVERT(VARCHAR(20),'{2}', 112) )
                                                            AND (FK_HREmployeeID in (Select FK_HREmployeeID from ARSellers where ARSellerID={3} and AAStatus='Alive') or 0={3})"
                                       , Type, String.Format("{0:yyyyMMdd}", fromdate), String.Format("{0:yyyyMMdd}", todate), iARSellerID);
            DataSet ds = dal.GetDataSet(query);
            if (ds != null && ds.Tables.Count > 0 && ds.Tables[0].Rows.Count > 0 && ds.Tables[0].Rows[0][0] != DBNull.Value)
                return Convert.ToInt32(ds.Tables[0].Rows[0][0]);

            return 0;
        }
        public DataSet GetAllDataByTypeSellerInRange(int iARSellerID, String Type, DateTime fromdate, DateTime todate)
        {
            String query = String.Format(@"Select * From ARSaleOpps Where AAStatus = 'Alive' And ARSaleOppStatusCombo = '{0}'
                                                            And (CONVERT(VARCHAR(20), [ARSaleOppStartDate], 112) 
                                                            Between CONVERT(VARCHAR(20),'{1}', 112) And CONVERT(VARCHAR(20),'{2}', 112) )
                                                            AND (FK_HREmployeeID in (Select FK_HREmployeeID from ARSellers where ARSellerID={3} and AAStatus='Alive') or 0={3})"
                                       , Type, String.Format("{0:yyyyMMdd}", fromdate), String.Format("{0:yyyyMMdd}", todate), iARSellerID);
            return dal.GetDataSet(query);
        }

        public DataSet GetAllDataByTypeSellerInRange(int iARSellerID, DateTime fromdate, DateTime todate)
        {
            String strSell = String.Empty;
            if (iARSellerID > 0)
                strSell = String.Format(@" AND (FK_HREmployeeID in (Select FK_HREmployeeID from ARSellers where ARSellerID={0} and AAStatus='Alive') or 0={0})", iARSellerID);

            String strTime = DALUtil.GenerateBeetween("ARSaleOppStartDate", fromdate, todate);

            String query = String.Format(@"Select * From ARSaleOpps Where AAStatus = 'Alive'
                                                            AND {0} {1}", strTime, strSell);

            return GetDataSet(query);
                                      
        }

        public int GetCountSaleOppByCampaignID(int iCampaignID)
        {
            string strQuery = String.Format(@"SELECT COUNT(*) FROM ARSaleOpps WHERE AAStatus='Alive' AND FK_CMCampaignID={0}", iCampaignID);
            DataSet ds = (DataSet)GetDataSet(strQuery);
            if (ds != null && ds.Tables.Count > 0 && ds.Tables[0].Rows.Count > 0 && ds.Tables[0].Rows[0][0] != DBNull.Value)
                return Convert.ToInt32(ds.Tables[0].Rows[0][0]);

            return 0;
        }

        public double GetSumAmtInStage(int iSaleStageID)
        {
            string strQuery = String.Format(@"SELECT SUM(ARSaleOppSaleAmt)
                                                FROM ARSaleOpps 
                                                WHERE AAStatus='Alive' 
                                                AND ARSaleOppID IN (SELECT FK_ARSaleOppID FROM ARSaleOppStages WHERE AAStatus = 'Alive' AND FK_ARSaleStageID = {0})", iSaleStageID);
            DataSet ds = (DataSet)GetDataSet(strQuery);
            if (ds != null && ds.Tables.Count > 0 && ds.Tables[0].Rows.Count > 0 && ds.Tables[0].Rows[0][0] != DBNull.Value)
                return Convert.ToDouble(ds.Tables[0].Rows[0][0]);

            return 0;
        }

        public DataSet GetAmtByCampaignAndStatus(int iCampaignID, String strStatus)
        {
            String strStatusCond = String.Empty;
            if (String.IsNullOrEmpty(strStatusCond) == false)
                strStatusCond = String.Format(@" AND ARSaleOppStatusCombo = '{0}'", strStatus);

            string strQuery = String.Format(@"SELECT Count(*),SUM(ARSaleOppSaleAmt)
                                                FROM ARSaleOpps 
                                                WHERE AAStatus='Alive' 
                                                AND FK_CMCampaignID = {0} {1}", iCampaignID, strStatusCond);

            return GetDataSet(strQuery);
        }


        public DataSet GetAllSaleOppByEmployeeAndStatus(int iEmployeeID, String strStatus)
        {
            string strQuery = String.Format(@"SELECT *
                                                FROM ARSaleOpps 
                                                WHERE AAStatus='Alive' 
                                                AND FK_HREmployeeID = {0} AND ARSaleOppStatusCombo = '{1}'", iEmployeeID, strStatus);
            return GetDataSet(strQuery);
        }

        public DataSet GetAllSaleOppByDellerAndStatus(int iSellerID, String strStatus)
        {
            string strQuery = String.Format(@"SELECT *
                                                FROM ARSaleOpps 
                                                WHERE AAStatus='Alive' 
                                                AND FK_ARSellerID = {0} AND ARSaleOppStatusCombo = '{1}'", iSellerID, strStatus);
            return GetDataSet(strQuery);
        }

        #region Get Amt by status
        public double GetSumAmtByEmployeeAndStatus(int iEmployeeID, String strSumField, String strStatus, DateTime dtFrom, DateTime dtTo)
        {
            String strTime = DALUtil.GenerateBeetween("ARSaleOppStartDate", dtFrom, dtTo);

            String strEmpCond = String.Empty;
            if (iEmployeeID > 0)
                strEmpCond = String.Format(" AND FK_HREmployeeID = {0}", iEmployeeID);

            String strStatusCond = String.Empty;
            if (String.IsNullOrEmpty(strStatus) == false)
                strStatusCond = String.Format(@" AND ARSaleOppStatusCombo = '{0}'", strStatus);

            string strQuery = String.Format(@"SELECT SUM({0})
                                                FROM ARSaleOpps 
                                                WHERE AAStatus='Alive' 
                                                {1} {2}
                                                AND {3}
                                                ",strSumField, strEmpCond, strStatusCond, strTime);

            DataSet ds = (DataSet)GetDataSet(strQuery);
            if (ds != null && ds.Tables.Count > 0 && ds.Tables[0].Rows.Count > 0 && ds.Tables[0].Rows[0][0] != DBNull.Value)
                return Convert.ToDouble(ds.Tables[0].Rows[0][0]);

            return 0;
        }
        public double GetSumAmtBySellerAndStatus(int iSellerID, String strSumField, String strStatus, DateTime dtFrom, DateTime dtTo)
        {
            String strTime = DALUtil.GenerateBeetween("ARSaleOppStartDate", dtFrom, dtTo);

            String strEmpCond = String.Empty;
            if (iSellerID > 0)
                strEmpCond = String.Format(" AND FK_ARSellerID = {0}", iSellerID);

            String strStatusCond = String.Empty;
            if (String.IsNullOrEmpty(strStatus) == false)
                strStatusCond = String.Format(@" AND ARSaleOppStatusCombo = '{0}'", strStatus);

            string strQuery = String.Format(@"SELECT SUM({0})
                                                FROM ARSaleOpps 
                                                WHERE AAStatus='Alive' 
                                                {1} {2}
                                                AND {3}
                                                ", strSumField, strEmpCond, strStatusCond, strTime);

            DataSet ds = (DataSet)GetDataSet(strQuery);
            if (ds != null && ds.Tables.Count > 0 && ds.Tables[0].Rows.Count > 0 && ds.Tables[0].Rows[0][0] != DBNull.Value)
                return Convert.ToDouble(ds.Tables[0].Rows[0][0]);

            return 0;
        }
        #endregion

        public DataSet GetAllBySellerAndStatus(int iSellerID, String strStatus, DateTime dtFrom, DateTime dtTo)
        {
            String strTime = DALUtil.GenerateBeetween("ARSaleOppStartDate", dtFrom, dtTo);

            String strStatusCond = String.Empty;
            if (String.IsNullOrEmpty(strStatus) == false)
                strStatusCond = String.Format(@" AND ARSaleOppStatusCombo = '{0}'", strStatus);

            String strSellerCond = String.Empty;
            if (iSellerID > 0)
                strSellerCond = String.Format(@" AND FK_ARSellerID = {0}", iSellerID);

            string strQuery = String.Format(@"SELECT *
                                                FROM ARSaleOpps 
                                                WHERE AAStatus='Alive' 
                                                {0}
                                                {1}
                                                AND {2}", strSellerCond, strStatusCond, strTime);

            return GetDataSet(strQuery);
        }

        public double GetCountBySellerAndStatus(int iSellerID, String strStatus, DateTime dtFrom, DateTime dtTo)
        {
            String strTime = DALUtil.GenerateBeetween("ARSaleOppStartDate", dtFrom, dtTo);

            String strStatusCond = String.Empty;
            if (String.IsNullOrEmpty(strStatus) == false)
                strStatusCond = String.Format(@" AND ARSaleOppStatusCombo = '{0}'", strStatus);

            String strSellerCond = String.Empty;
            if (iSellerID > 0)
                strSellerCond = String.Format(@" AND FK_ARSellerID = {0}", iSellerID);

            string strQuery = String.Format(@"SELECT Count(*)
                                                FROM ARSaleOpps 
                                                WHERE AAStatus='Alive' 
                                                {0}
                                                {1}
                                                AND {2}", strSellerCond, strStatusCond, strTime);

            DataSet ds = (DataSet)GetDataSet(strQuery);
            if (ds != null && ds.Tables.Count > 0 && ds.Tables[0].Rows.Count > 0 && ds.Tables[0].Rows[0][0] != DBNull.Value)
                return Convert.ToDouble(ds.Tables[0].Rows[0][0]);

            return 0;
        }

    }
	#endregion
}