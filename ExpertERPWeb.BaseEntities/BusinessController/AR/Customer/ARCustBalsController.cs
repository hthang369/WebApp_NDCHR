using System;
using System.Data;
using System.Text;
using System.Collections.Generic;
using ExpertWebLib;
namespace ExpertERP.BusinessEntities
{
	#region ARCustBals
	//-----------------------------------------------------------
	//Generated By: Expert Studio
	//Class:ARCustBalsController
	//Created Date:Thursday, December 30, 2010
	//-----------------------------------------------------------
	
	public class ARCustBalsController:BaseBusinessController
	{
		public ARCustBalsController()
		{
			dal= new DALBaseProvider("ARCustBals",typeof(ARCustBalsInfo));
		}

        public ARCustBalsInfo GetCustBalace_byYearMonthAndFK_CustomerID ( int year , int month , int FK_ARCustomerID )
        {
            return (ARCustBalsInfo)dal.GetDataObject("ARCustomerBalance_SelectByYearMonthAndFK_CustomerID" , year , month , FK_ARCustomerID );
        }

        public ARCustBalsInfo GetCustBalInPeriodByCustomer(int iPeriod, int iYear, int iCustomerID)
        {
            String strQuery = String.Format(@"SELECT * FROM  ARCustBals Where AAStatus = 'Alive' And ARCustBalPeriod = {0} AND ARCustBalYear = {1} And FK_ARCustomerID = {2}", iPeriod, iYear, iCustomerID);
            DataSet ds = dal.GetDataSet(strQuery);

            if (ds != null && ds.Tables.Count > 0 && ds.Tables[0].Rows.Count > 0 && ds.Tables[0].Rows[0][0] != DBNull.Value)
                return (ARCustBalsInfo)dal.GetObjectFromDataRow(ds.Tables[0].Rows[0]);

            return null;
        }
        public ARCustBalsInfo GetCustBalBegin(int iCustomerID)
        {
            String strQuery = String.Format(@"SELECT TOP 1 * FROM dbo.ARCustBals WHERE AAStatus='Alive' AND FK_ARCustomerID={0} 
                                                    ORDER BY ARCustBalYear, ARCustBalPeriod", iCustomerID);
            DataSet ds = dal.GetDataSet(strQuery);

            if (ds != null && ds.Tables.Count > 0 && ds.Tables[0].Rows.Count > 0)
                return (ARCustBalsInfo)dal.GetObjectFromDataRow(ds.Tables[0].Rows[0]);

            return null;
        }
        public ARCustBalsInfo GetCustBalEnd(int iCustomerID)
        {
            String strQuery = String.Format(@"SELECT TOP 1 * FROM dbo.ARCustBals WHERE AAStatus='Alive' AND FK_ARCustomerID={0} 
                                                    ORDER BY ARCustBalYear Desc, ARCustBalPeriod Desc", iCustomerID);
            DataSet ds = dal.GetDataSet(strQuery);

            if (ds != null && ds.Tables.Count > 0 && ds.Tables[0].Rows.Count > 0)
                return (ARCustBalsInfo)dal.GetObjectFromDataRow(ds.Tables[0].Rows[0]);

            return null;
        }

        public void DeleteCustomerBalanceBeforeMonthAndYear(int iCustomerID, int iPeriod, int iYear)
        {
            String strQuery = String.Format(@"UPDATE dbo.ARCustBals SET AAStatus='Delete' WHERE AAStatus='Alive' AND FK_ARCustomerID={0} AND ARCustBalPeriod< {1} AND ARCustBalYear<={2}"
                                                    , iCustomerID, iPeriod, iYear);
           dal.GetDataSet(strQuery);
        }
	}
	#endregion
}