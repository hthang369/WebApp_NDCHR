using System;
using System.Data;
using System.Text;
using System.Collections.Generic;
using ExpertWebLib;
namespace ExpertERP.BusinessEntities
{
	#region ARCampaignItemSales
	//-----------------------------------------------------------
	//Generated By: GMC Studio
	//Class:ARCampaignItemSalesController
	//Created Date:Friday, May 11, 2012
	//-----------------------------------------------------------
	
	public class ARCampaignItemSalesController:BaseBusinessController
	{
		public ARCampaignItemSalesController()
		{
			dal= new DALBaseProvider("ARCampaignItemSales",typeof(ARCampaignItemSalesInfo));
		}

        public DataSet GetMinCampaignItemFromAmtBySOAmtTot(double dSOAmtTot,DateTime dtSODate)
        {
            string strQuery = String.Format(@"SELECT TOP 1 * FROM ARCampaignItemSales INNER JOIN ARCampaigns 
                                            ON ARCampaignItemSales.FK_ARCampaignID=ARCampaigns.ARCampaignID
                                        WHERE ARCampaigns.AAStatus='Alive' 
                                            AND CONVERT(VARCHAR(10), [ARCampaignStartDate], 112)<= CONVERT(VARCHAR(10), '{0}', 112)
                                            AND CONVERT(VARCHAR(10), [ARCampaignEndDate], 112)>= CONVERT(VARCHAR(10), '{0}', 112)
                                            AND ARCampaignItemSales.AAStatus='Alive' 
                                            AND ARCampaignItemSales.ARCampaignItemSaleFromAmt > {1}
                                            ORDER BY ARCampaignItemSales.ARCampaignItemSaleFromAmt"
                                        , dtSODate.ToString("yyyyMMdd"), dSOAmtTot);
            return dal.GetDataSet(strQuery);
        }

        public double GetDiscountPctByCampaignAndMinFromAmt(double dSOAmtTot, DateTime dtSODate)
        {
            string strQuery = String.Format(@"SELECT ARCampaignItemSaleDiscPct FROM ARCampaignItemSales INNER JOIN ARCampaigns 
                                                ON ARCampaignItemSales.FK_ARCampaignID=ARCampaigns.ARCampaignID  
                                                WHERE ARCampaigns.AAStatus='Alive' 
                                                AND ARCampaignItemSales.AAStatus='Alive' 
                                                AND CONVERT(VARCHAR(10), [ARCampaignStartDate], 112)<= CONVERT(VARCHAR(10), '{0}', 112)
                                                AND CONVERT(VARCHAR(10), [ARCampaignEndDate], 112)>= CONVERT(VARCHAR(10), '{0}', 112)
                                                AND ARCampaignItemSales.ARCampaignItemSaleFromAmt <= {1} 
                                                AND ARCampaignItemSales.ARCampaignItemSaleToAmt > {1} 
                                                "
                                                , dtSODate.ToString("yyyyMMdd"), dSOAmtTot);
            DataSet ds = dal.GetDataSet(strQuery);
            if (ds != null && ds.Tables.Count > 0 && ds.Tables[0].Rows.Count > 0)
            {
                return Convert.ToDouble(ds.Tables[0].Rows[0][0]);
            }

            return 0;
        }

        public double GetDiscountPctByAmtInRange(double dbAmt, int iPeriod, int iYear)
        {
            string strQuery = String.Format(@"SELECT ARCampaignItemSaleDiscPct FROM ARCampaignItemSales INNER JOIN ARCampaigns 
                                                ON ARCampaignItemSales.FK_ARCampaignID=ARCampaigns.ARCampaignID  
                                                WHERE ARCampaigns.AAStatus='Alive' 
                                                AND ARCampaignItemSales.AAStatus='Alive' 
                                                AND Month(ARCampaignStartDate)+Year(ARCampaignStartDate)*12>={0}
                                                AND Month(ARCampaignEndDate) + Year(ARCampaignEndDate)*12>={0}
                                                AND ARCampaignItemSales.ARCampaignItemSaleFromAmt <= {1} 
                                                AND ARCampaignItemSales.ARCampaignItemSaleToAmt > {1} 
                                                ORDER BY ARCampaignItemSaleDiscPct DESC
                                                ", iPeriod + iYear * 12, dbAmt);
                                                
            DataSet ds = dal.GetDataSet(strQuery);
            if (ds != null && ds.Tables.Count > 0 && ds.Tables[0].Rows.Count > 0&&ds.Tables[0].Rows[0][0]!=DBNull.Value)
            {
                return Convert.ToDouble(ds.Tables[0].Rows[0][0]);
            }

            return 0;
        }
    }
	#endregion
}